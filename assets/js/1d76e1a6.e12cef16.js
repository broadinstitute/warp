"use strict";(self.webpackChunkwebsite_2=self.webpackChunkwebsite_2||[]).push([[6260],{5680:(e,t,a)=>{a.d(t,{xA:()=>g,yg:()=>h});var n=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},g=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,g=s(e,["components","mdxType","originalType","parentName"]),d=p(a),u=r,h=d["".concat(o,".").concat(u)]||d[u]||m[u]||i;return a?n.createElement(h,l(l({ref:t},g),{},{components:a})):n.createElement(h,l({ref:t},g))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[d]="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},8123:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(9668),r=(a(6540),a(5680));const i={sidebar_position:1,slug:"/Pipelines/RNA_with_UMIs_Pipeline/README"},l="RNA with UMIs Overview",s={unversionedId:"Pipelines/RNA_with_UMIs_Pipeline/README",id:"Pipelines/RNA_with_UMIs_Pipeline/README",title:"RNA with UMIs Overview",description:"| Pipeline Version | Date Updated | Documentation Authors | Questions or Feedback |",source:"@site/docs/Pipelines/RNA_with_UMIs_Pipeline/README.md",sourceDirName:"Pipelines/RNA_with_UMIs_Pipeline",slug:"/Pipelines/RNA_with_UMIs_Pipeline/README",permalink:"/warp/docs/Pipelines/RNA_with_UMIs_Pipeline/README",draft:!1,editUrl:"https://github.com/broadinstitute/warp/edit/develop/website/docs/Pipelines/RNA_with_UMIs_Pipeline/README.md",tags:[],version:"current",lastUpdatedBy:"Robert Sidney Cox",lastUpdatedAt:1733411364,formattedLastUpdatedAt:"Dec 5, 2024",sidebarPosition:1,frontMatter:{sidebar_position:1,slug:"/Pipelines/RNA_with_UMIs_Pipeline/README"},sidebar:"docsSidebar",previous:{title:"Paired-Tag Overview",permalink:"/warp/docs/Pipelines/PairedTag_Pipeline/README"},next:{title:"RNA with UMIs v1.0.16 Methods",permalink:"/warp/docs/Pipelines/RNA_with_UMIs_Pipeline/rna-with-umis.methods"}},o={},p=[{value:"Introduction to the RNA with UMIs workflow",id:"introduction-to-the-rna-with-umis-workflow",level:2},{value:"Quickstart table",id:"quickstart-table",level:2},{value:"Set-up",id:"set-up",level:2},{value:"Installation",id:"installation",level:3},{value:"Inputs",id:"inputs",level:3},{value:"Input descriptions",id:"input-descriptions",level:4},{value:"References",id:"references",level:3},{value:"FASTA, index, and dictionary files",id:"fasta-index-and-dictionary-files",level:4},{value:"GTF file",id:"gtf-file",level:4},{value:"Ribosomal interval list and refFlat file",id:"ribosomal-interval-list-and-refflat-file",level:4},{value:"Additional reference resources",id:"additional-reference-resources",level:4},{value:"RNA with UMIs tasks and tools",id:"rna-with-umis-tasks-and-tools",level:2},{value:"1. Convert FASTQ to uBAM",id:"1-convert-fastq-to-ubam",level:4},{value:"2. UMI extraction",id:"2-umi-extraction",level:4},{value:"3. Convert uBAM to FASTQs and filter reads",id:"3-convert-ubam-to-fastqs-and-filter-reads",level:4},{value:"4. Trim adapters and poly(A) tails",id:"4-trim-adapters-and-polya-tails",level:4},{value:"5. Convert FASTQs to uBAM",id:"5-convert-fastqs-to-ubam",level:4},{value:"6. Alignment with STAR",id:"6-alignment-with-star",level:4},{value:"7. Mark duplicates and sort BAMs",id:"7-mark-duplicates-and-sort-bams",level:4},{value:"8. Gene quantification",id:"8-gene-quantification",level:4},{value:"9. Metric calculation",id:"9-metric-calculation",level:4},{value:"10. Outputs",id:"10-outputs",level:4},{value:"Versioning",id:"versioning",level:2},{value:"Citing the RNA with UMIs Pipeline",id:"citing-the-rna-with-umis-pipeline",level:2},{value:"Feedback",id:"feedback",level:2}],g={toc:p},d="wrapper";function m(e){let{components:t,...i}=e;return(0,r.yg)(d,(0,n.A)({},g,i,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"rna-with-umis-overview"},"RNA with UMIs Overview"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"center"},"Pipeline Version"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Date Updated"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Documentation Authors"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Questions or Feedback"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/releases?q=RNAwithUMIs&expanded=true"},"RNAWithUMIsPipeline_v1.0.16")),(0,r.yg)("td",{parentName:"tr",align:"center"},"February, 2024"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Elizabeth Kiernan & Kaylee Mathews"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Please ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/issues"},"file an issue in WARP"),".")))),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"RNAWithUMIs_diagram",src:a(7492).A,width:"1299",height:"2644"})),(0,r.yg)("h2",{id:"introduction-to-the-rna-with-umis-workflow"},"Introduction to the RNA with UMIs workflow"),(0,r.yg)("p",null,"The ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/blob/master/pipelines/broad/rna_seq/RNAWithUMIsPipeline.wdl"},"RNA with UMIs pipeline")," is an open-source, cloud-optimized workflow for processing total RNA isolated with the Transcriptome Capture (TCap) method. TCap is a technique that hybridizes exome baits to cDNA library preparations to better facilitate RNA-sequencing in low-input or poor quality (degraded) samples. These libraries may additionally be prepared with Unique Molecular Identifiers (UMIs), which can help distinguish biological signal from noise resulting from PCR amplification."),(0,r.yg)("p",null,"Overall, the workflow performs UMI correction, aligns reads to the genome, quantifies gene counts, and calculates quality metrics. The workflow produces genome- and transcriptome-aligned BAMs with indices and quality metrics files. "),(0,r.yg)("p",null,"While this workflow was created to be used with TCap RNA-seq data, it can be used to process any bulk RNA-seq data. "),(0,r.yg)("admonition",{title:"Want to use the RNA with UMIs pipeline for your publication?",type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"Check out the ",(0,r.yg)("a",{parentName:"p",href:"/warp/docs/Pipelines/RNA_with_UMIs_Pipeline/rna-with-umis.methods"},"RNA with UMIs Methods")," section to get started!")),(0,r.yg)("h2",{id:"quickstart-table"},"Quickstart table"),(0,r.yg)("p",null,"The following table provides a quick glance at the RNA with UMIs pipeline features:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Pipeline features"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"),(0,r.yg)("th",{parentName:"tr",align:null},"Source"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Assay type"),(0,r.yg)("td",{parentName:"tr",align:null},"TCap (or any bulk) RNA-seq data"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://genome.cshlp.org/content/25/9/1372"},"Cieslik et al. 2015"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Overall workflow"),(0,r.yg)("td",{parentName:"tr",align:null},"Read alignment and transcriptome quantification"),(0,r.yg)("td",{parentName:"tr",align:null},"Code available from ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/pipelines/broad/rna_seq/RNAWithUMIsPipeline.wdl"},"GitHub"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Workflow language"),(0,r.yg)("td",{parentName:"tr",align:null},"WDL 1.0"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/openwdl/wdl"},"openWDL"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Genomic reference sequence"),(0,r.yg)("td",{parentName:"tr",align:null},"GRCh38 (hg38) and GRCh37 (hg19) human genome primary sequence"),(0,r.yg)("td",{parentName:"tr",align:null},"Genome Reference Consortium ",(0,r.yg)("a",{parentName:"td",href:"https://www.ncbi.nlm.nih.gov/assembly/GCF_000001405.39"},"GRCh38")," and ",(0,r.yg)("a",{parentName:"td",href:"https://www.ncbi.nlm.nih.gov/assembly/GCF_000001405.25/"},"GRCh37"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Gene annotations"),(0,r.yg)("td",{parentName:"tr",align:null},"GENCODE v34 (hg38) and v19 (hg19) gene annotations"),(0,r.yg)("td",{parentName:"tr",align:null},"GENCODE ",(0,r.yg)("a",{parentName:"td",href:"https://www.gencodegenes.org/human/release_34.html"},"v34")," and ",(0,r.yg)("a",{parentName:"td",href:"https://www.gencodegenes.org/human/release_19.html"},"v19"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Aligner"),(0,r.yg)("td",{parentName:"tr",align:null},"STAR"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/alexdobin/STAR"},"STAR"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Transcript quantification and metric calculation"),(0,r.yg)("td",{parentName:"tr",align:null},"RNA-SeQC, Picard, and GATK"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/getzlab/rnaseqc"},"RNA-SeQC"),", ",(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard"),", and ",(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us"},"GATK"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Data input file format"),(0,r.yg)("td",{parentName:"tr",align:null},"File format in which sequencing data is provided"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"http://samtools.github.io/hts-specs/"},"BAM")," or ",(0,r.yg)("a",{parentName:"td",href:"https://academic.oup.com/nar/article/38/6/1767/3112533"},"FASTQ"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Data output file formats"),(0,r.yg)("td",{parentName:"tr",align:null},"File formats in which RNA with UMIs outputs are provided"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"http://samtools.github.io/hts-specs/"},"BAM"),"; GCT (counts); TXT, TSV, and PDF (metrics)")))),(0,r.yg)("h2",{id:"set-up"},"Set-up"),(0,r.yg)("h3",{id:"installation"},"Installation"),(0,r.yg)("p",null,'To download the latest release of the RNA with UMIs pipeline, see the release tags prefixed with "RNAwithUMIs" on the WARP ',(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/releases"},"releases page"),". All releases of the RNA with UMIs pipeline are documented in the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/blob/master/pipelines/broad/rna_seq/RNAWithUMIsPipeline.changelog.md"},"RNA with UMIs changelog"),". "),(0,r.yg)("p",null,"To search releases of this and other pipelines, use the WARP command-line tool ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/tree/master/wreleaser"},"Wreleaser"),"."),(0,r.yg)("p",null,"If you\u2019re running an RNA with UMIs workflow version prior to the latest release, the accompanying documentation for that release may be downloaded with the source code on the WARP ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/releases"},"releases page")," (see the source code folder ",(0,r.yg)("inlineCode",{parentName:"p"},"website/docs/Pipelines/RNA_with_UMIs_Pipeline"),")."),(0,r.yg)("p",null,"The RNA with UMIs pipeline can be deployed using ",(0,r.yg)("a",{parentName:"p",href:"https://cromwell.readthedocs.io/en/stable/"},"Cromwell"),", a GA4GH compliant, flexible workflow management system that supports multiple computing platforms. The workflow can also be run in ",(0,r.yg)("a",{parentName:"p",href:"https://app.terra.bio"},"Terra"),", a cloud-based analysis platform. "),(0,r.yg)("h3",{id:"inputs"},"Inputs"),(0,r.yg)("p",null,"The RNA with UMIs workflow inputs are specified in JSON configuration files. Example configuration files can be found in the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/tree/master/pipelines/broad/rna_seq/test_inputs"},"test_inputs")," folder in the WARP repository."),(0,r.yg)("h4",{id:"input-descriptions"},"Input descriptions"),(0,r.yg)("p",null,"The workflow takes in either a set of paired-end FASTQ files or a read group unmapped BAM that has gone through base calling. "),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Input variable name"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"bam"),(0,r.yg)("td",{parentName:"tr",align:null},"Read group-specific unmapped BAM file; alternatively, paired-end FASTQ files (",(0,r.yg)("inlineCode",{parentName:"td"},"r1_fastq")," and ",(0,r.yg)("inlineCode",{parentName:"td"},"r2_fastq"),") may be used."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"r1_fastq"),(0,r.yg)("td",{parentName:"tr",align:null},"Read 1 FASTQ file; alternatively, the unmapped bam file (",(0,r.yg)("inlineCode",{parentName:"td"},"bam"),") may be used as input."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"r2_fastq"),(0,r.yg)("td",{parentName:"tr",align:null},"Read 2 FASTQ file; alternatively, the unmapped bam file (",(0,r.yg)("inlineCode",{parentName:"td"},"bam"),") may be used as input."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"read1Structure"),(0,r.yg)("td",{parentName:"tr",align:null},"String describing how the bases in a sequencing run should be allocated into logical reads for read 1 by fgbio's ",(0,r.yg)("a",{parentName:"td",href:"http://fulcrumgenomics.github.io/fgbio/tools/latest/ExtractUmisFromBam.html"},"ExtractUmisFromBam")," tool; for more information about read structures, see the ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/fulcrumgenomics/fgbio/wiki/Read-Structures"},"fgbio documentation"),"."),(0,r.yg)("td",{parentName:"tr",align:null},"String")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"read2Structure"),(0,r.yg)("td",{parentName:"tr",align:null},"String describing how the bases in a sequencing run should be allocated into logical reads for read 2 by fgbio's ",(0,r.yg)("a",{parentName:"td",href:"http://fulcrumgenomics.github.io/fgbio/tools/latest/ExtractUmisFromBam.html"},"ExtractUmisFromBam")," tool; for more information about read structures, see the ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/fulcrumgenomics/fgbio/wiki/Read-Structures"},"fgbio documentation"),"."),(0,r.yg)("td",{parentName:"tr",align:null},"String")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"output_basename"),(0,r.yg)("td",{parentName:"tr",align:null},"String used as a prefix in workflow output files."),(0,r.yg)("td",{parentName:"tr",align:null},"String")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"platform"),(0,r.yg)("td",{parentName:"tr",align:null},"String used to describe the sequencing platform."),(0,r.yg)("td",{parentName:"tr",align:null},"String")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"library_name"),(0,r.yg)("td",{parentName:"tr",align:null},"String used to describe the library."),(0,r.yg)("td",{parentName:"tr",align:null},"String")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"platform_unit"),(0,r.yg)("td",{parentName:"tr",align:null},"String used to describe the platform unit."),(0,r.yg)("td",{parentName:"tr",align:null},"String")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"read_group_name"),(0,r.yg)("td",{parentName:"tr",align:null},"String used to describe the read group name."),(0,r.yg)("td",{parentName:"tr",align:null},"String")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sequencing_center"),(0,r.yg)("td",{parentName:"tr",align:null},'String used to describe the sequencing center; default is set to "BI".'),(0,r.yg)("td",{parentName:"tr",align:null},"String")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"starIndex"),(0,r.yg)("td",{parentName:"tr",align:null},"TAR file containing genome indices used for the ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/alexdobin/STAR"},"STAR aligner"),"."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"gtf"),(0,r.yg)("td",{parentName:"tr",align:null},"Gene annotation file (GTF) used for the ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/getzlab/rnaseqc"},"RNA-SeQC")," tool."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"ref"),(0,r.yg)("td",{parentName:"tr",align:null},"FASTA file used for metric collection with ",(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")," tools."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"refIndex"),(0,r.yg)("td",{parentName:"tr",align:null},"FASTA index file used for metric collection with ",(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")," tools."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"refDict"),(0,r.yg)("td",{parentName:"tr",align:null},"Dictionary file used for metric collection with ",(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")," tools."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"refFlat"),(0,r.yg)("td",{parentName:"tr",align:null},"refFlat file used for metric collection with ",(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")," tools."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"ribosomalIntervals"),(0,r.yg)("td",{parentName:"tr",align:null},"Intervals file used for RNA metric collection with ",(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")," tools."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"exonBedFile"),(0,r.yg)("td",{parentName:"tr",align:null},"Bed file used for fragment size calculations with the ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/getzlab/rnaseqc"},"RNA-SeQC")," tool; contains non-overlapping exons."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"population_vcf"),(0,r.yg)("td",{parentName:"tr",align:null},"VCF file used for contamination estimation by GATK's ",(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us/articles/4418051471643-GetPileupSummaries"},"GetPileupSummaries")," and ",(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us/articles/4418054253211-CalculateContamination"},"CalculateContamination")," tools; contains common SNP sites from population-wide studies."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"population_vcf_index"),(0,r.yg)("td",{parentName:"tr",align:null},"Population VCF index file used for contamination estimation by GATK's ",(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us/articles/4418051471643-GetPileupSummaries"},"GetPileupSummaries")," and ",(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us/articles/4418054253211-CalculateContamination"},"CalculateContamination")," tools."),(0,r.yg)("td",{parentName:"tr",align:null},"File")))),(0,r.yg)("h3",{id:"references"},"References"),(0,r.yg)("p",null,"The pipeline supports both hg19 and hg38 references. The reference set consists of:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},".fasta, .fai, and .dict files"),(0,r.yg)("li",{parentName:"ol"},"STAR index"),(0,r.yg)("li",{parentName:"ol"},"GTF file (RNASeQC)"),(0,r.yg)("li",{parentName:"ol"},"ribosomal interval list and refFlat file (Picard)")),(0,r.yg)("h4",{id:"fasta-index-and-dictionary-files"},"FASTA, index, and dictionary files"),(0,r.yg)("p",null,"When running the workflow with the hg38 reference, we recommend using a version without HLA, ALT, and decoy contigs. These non-primary assembly contigs lead to reduced sensitivity unless the mapper is ALT-aware (e.g., bwa-mem). STAR is not ALT-aware, so these contigs should be removed."),(0,r.yg)("p",null,"In contrast, the hg19 reference does not have nearly as many contigs as the hg38 reference, so the workflow can be run using the standard hg19 reference stored in Broad's ",(0,r.yg)("a",{parentName:"p",href:"https://console.cloud.google.com/storage/browser/_details/gcp-public-data--broad-references/hg19/v0/Homo_sapiens_assembly19.fasta"},"public reference bucket"),"."),(0,r.yg)("h4",{id:"gtf-file"},"GTF file"),(0,r.yg)("p",null,"Genome annotation files (GTFs) contain information about genes, such as the start and end coordinates of each exon, the name of the gene, and the type of the transcript (e.g., protein-coding, antisense). The workflow uses the GENCODE v34 GTF for hg38 and v19 for hg19."),(0,r.yg)("h4",{id:"ribosomal-interval-list-and-refflat-file"},"Ribosomal interval list and refFlat file"),(0,r.yg)("p",null,"The workflow ribosomal interval list and the refFlat file are used by Picard metrics calculation tools. The workflow uses a custom ribosomal interval list based on the public hg38 ribosomal interval list, which has been modified to include mitochondrial rRNA coding genes. "),(0,r.yg)("h4",{id:"additional-reference-resources"},"Additional reference resources"),(0,r.yg)("p",null,"For more information about ALT contigs, HLA, decoys, and ALT-aware mapping, see the following resources:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://lh3.github.io/2017/11/13/which-human-reference-genome-to-use"},"Heng Li's blog")," where he argues for removing ALT contigs to improve sensitivity (for both DNA and RNA). "),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://gatk.broadinstitute.org/hc/en-us/articles/360041155232-Reference-Genome-Components"},"GATK blog post")," describing the components of a reference genome. "),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://support.illumina.com/content/dam/illumina-support/help/Illumina_DRAGEN_Bio_IT_Platform_v3_7_1000000141465/Content/SW/Informatics/Dragen/GPipelineAltMap_fDG.htm"},"Illumina DRAGEN documentation")," describing ALT-aware mapping. ")),(0,r.yg)("h2",{id:"rna-with-umis-tasks-and-tools"},"RNA with UMIs tasks and tools"),(0,r.yg)("p",null,"The ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/blob/master/pipelines/broad/rna_seq/RNAWithUMIsPipeline.wdl"},"RNA with UMIs workflow")," imports two additional WDL scripts. The ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/UMIAwareDuplicateMarking.wdl"},"UMIAwareDuplicateMarking.wdl")," script is a nested workflow used to mark duplicate sequencing reads, while the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"RNAWithUMIsTasks.wdl"),' script contains individual "tasks" called by the workflow.'),(0,r.yg)("p",null,"Overall, the RNA with UMIs workflow:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Converts FASTQs to unmapped BAMs. "),(0,r.yg)("li",{parentName:"ol"},"Extracts UMIs. "),(0,r.yg)("li",{parentName:"ol"},"Converts unmapped BAMs to FASTQs and filters reads."),(0,r.yg)("li",{parentName:"ol"},"Trims adapters and poly(A) tails."),(0,r.yg)("li",{parentName:"ol"},"Converts FASTQs to unmapped BAMs. "),(0,r.yg)("li",{parentName:"ol"},"Aligns reads. "),(0,r.yg)("li",{parentName:"ol"},"Marks duplicate reads and sorts BAMs."),(0,r.yg)("li",{parentName:"ol"},"Quantifies gene counts. "),(0,r.yg)("li",{parentName:"ol"},"Calculates RNA and genomic metrics.")),(0,r.yg)("p",null,"The tools each task employs in the RNA with UMIs workflow are detailed in the table below. "),(0,r.yg)("p",null,"To see specific tool parameters, select the task WDL link in the table; then find the task and view the ",(0,r.yg)("inlineCode",{parentName:"p"},"command {}")," section of the task in the WDL script. To view or use the exact tool software, see the task's Docker image which is specified in the task WDL ",(0,r.yg)("inlineCode",{parentName:"p"},"input {}")," section as ",(0,r.yg)("inlineCode",{parentName:"p"},"String docker ="),"."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Task name and WDL link"),(0,r.yg)("th",{parentName:"tr",align:null},"Tool"),(0,r.yg)("th",{parentName:"tr",align:null},"Software"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.FastqToUbam")),(0,r.yg)("td",{parentName:"tr",align:null},"FastqToSam"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")),(0,r.yg)("td",{parentName:"tr",align:null},"Converts the paired-end FASTQ files to unmapped BAM.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.ExtractUMIs")),(0,r.yg)("td",{parentName:"tr",align:null},"ExtractUmisFromBam"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"http://fulcrumgenomics.github.io/fgbio/"},"fgbio")),(0,r.yg)("td",{parentName:"tr",align:null},"Extracts UMIs from the unmapped BAM and stores them in the RX tag of output BAM.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/develop/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.SamToFastq")),(0,r.yg)("td",{parentName:"tr",align:null},"FastqToSam"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")),(0,r.yg)("td",{parentName:"tr",align:null},"Converts the BAM file to paired-end FASTQ files for adapter clipping and removes reads that fail platform/vendor quality checks performed by the sequencing platform.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/develop/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.Fastp")),(0,r.yg)("td",{parentName:"tr",align:null},"fastp"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/OpenGene/fastp"},"fastp")),(0,r.yg)("td",{parentName:"tr",align:null},"Trims adapters and polyA tails from reads.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.FastqToUbam (alias = FastqToUbamAfterClipping)")),(0,r.yg)("td",{parentName:"tr",align:null},"FastqToSam"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")),(0,r.yg)("td",{parentName:"tr",align:null},"Converts the trimmed paired-end FASTQ files to unmapped BAM.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/develop/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.FastQC")),(0,r.yg)("td",{parentName:"tr",align:null},"FastQC"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/s-andrews/FastQC"},"FastQC")),(0,r.yg)("td",{parentName:"tr",align:null},"Collects overall quality control metrics before alignment and generates an HTML-formatted report.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.STAR")),(0,r.yg)("td",{parentName:"tr",align:null},"STAR"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/alexdobin/STAR"},"STAR")),(0,r.yg)("td",{parentName:"tr",align:null},"Aligns reads to the genome (using the StarIndex file) and outputs aligned reads to BAM. The task additionally converts the resulting BAM file to transcriptome coordinates, producing a transcriptome-aligned BAM. Parameters are listed below.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.CopyReadGroupsToHeader")),(0,r.yg)("td",{parentName:"tr",align:null},"view, reheader"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"http://www.htslib.org/"},"Samtools")),(0,r.yg)("td",{parentName:"tr",align:null},"Copies the read group information from the genome-aligned BAM to the transcriptome-aligned BAM.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/UMIAwareDuplicateMarking.wdl"},"UmiMD.UMIAwareDuplicateMarking")),(0,r.yg)("td",{parentName:"tr",align:null},"SortSam, MarkDuplicates, group"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard"),", ",(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us"},"GATK"),", ",(0,r.yg)("a",{parentName:"td",href:"https://umi-tools.readthedocs.io/en/latest/index.html"},"UMI-tools")),(0,r.yg)("td",{parentName:"tr",align:null},"Marks duplicates on the genome-aligned BAM and tags reads with error-corrected UMIs.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/UMIAwareDuplicateMarking.wdl"},"UmiMD.UMIAwareDuplicateMarking (alias = UMIAwareDuplicateMarkingTranscriptome)")),(0,r.yg)("td",{parentName:"tr",align:null},"SortSam, MarkDuplicates, group"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard"),", ",(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us"},"GATK"),", ",(0,r.yg)("a",{parentName:"td",href:"https://umi-tools.readthedocs.io/en/latest/index.html"},"UMI-tools")),(0,r.yg)("td",{parentName:"tr",align:null},"Marks duplicates on the transcriptome-aligned BAM and tags reads with error-corrected UMIs.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/develop/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.PostprocessTranscriptomeForRSEM")),(0,r.yg)("td",{parentName:"tr",align:null},"PostProcessReadsForRSEM"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us"},"GATK")),(0,r.yg)("td",{parentName:"tr",align:null},"Sorts reads for RSEM compatibility.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.GetSampleName")),(0,r.yg)("td",{parentName:"tr",align:null},"GetSampleName"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us"},"GATK")),(0,r.yg)("td",{parentName:"tr",align:null},"Writes the sample name from the unmapped BAM header into a separate text file.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.rnaseqc2")),(0,r.yg)("td",{parentName:"tr",align:null},"rnaseqc"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/getzlab/rnaseqc"},"RNA-SeQC")),(0,r.yg)("td",{parentName:"tr",align:null},"Uses the genome-aligned, duplicate-marked BAM file to calculate TPMs, gene counts, exon counts, fragment sizes, and additional metrics, each of which is outputted to an individual file.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.CollectRNASeqMetrics")),(0,r.yg)("td",{parentName:"tr",align:null},"CollectRNASeqMetrics"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")),(0,r.yg)("td",{parentName:"tr",align:null},"Calculates RNA metrics; strand specificity is set to SECOND_READ_TRANSCRIPTION_STRAND.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.CollectMultipleMetrics")),(0,r.yg)("td",{parentName:"tr",align:null},"CollectMultipleMetrics"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://broadinstitute.github.io/picard/"},"Picard")),(0,r.yg)("td",{parentName:"tr",align:null},"Collects multiple classes of metrics; runs tools CollectInsertSizeMetrics and CollectAlignmentSummaryMetrics.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.CalculateContamination")),(0,r.yg)("td",{parentName:"tr",align:null},"GetPileupSummaries, Calculate Contamination"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://gatk.broadinstitute.org/hc/en-us"},"GATK")),(0,r.yg)("td",{parentName:"tr",align:null},"Uses the population VCF and index files to calculate pileup metrics and estimate cross-sample contamination.")))),(0,r.yg)("h4",{id:"1-convert-fastq-to-ubam"},"1. Convert FASTQ to uBAM"),(0,r.yg)("p",null,"If paired-end FASTQ files are used as inputs for the pipeline, the first task in the pipeline converts those FASTQ files into an unmapped BAM file using Picard's ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/360036510672"},"FastqToSam"),"."),(0,r.yg)("p",null,"This task is skipped if a read group unmapped BAM file is used as input for the pipeline. "),(0,r.yg)("h4",{id:"2-umi-extraction"},"2. UMI extraction"),(0,r.yg)("p",null,"Unique molecular identifiers (UMIs) are DNA tags (bases) that identify each DNA molecule before PCR amplification. They enable us to detect whether two reads that align to the same position in the reference are sequences of the same DNA molecule (have the same UMIs; PCR duplicates) or are two separate copies of DNA that happen to have the same sequence (have different UMIs; biological or natural duplicates)."),(0,r.yg)("p",null,"For example, the Illumina sequencers used by the Broad Genomics Platform read 151 bp per read, of which 5 bp are reserved for the UMIs."),(0,r.yg)("p",null,"The first step of the RNA with UMIs workflow is to use the fgbio's ",(0,r.yg)("a",{parentName:"p",href:"http://fulcrumgenomics.github.io/fgbio/tools/latest/ExtractUmisFromBam.html"},"ExtractUMIsFromBam")," to remove UMI bases from the reads and store them in the RX read tag. "),(0,r.yg)("p",null,'The resulting RX tag may contain information like "ACT-GCT." The "ACT" is the 3 bp for read 1 and the "GCT" is the 3 bp for read 2. Even though we reserve 5 bases in a read, we only use 3 bases for UMI; the other two bases are reserved for cell barcode, which the workflow doesn\'t use.'),(0,r.yg)("h4",{id:"3-convert-ubam-to-fastqs-and-filter-reads"},"3. Convert uBAM to FASTQs and filter reads"),(0,r.yg)("p",null,"The ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/blob/develop/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.SamToFastq")," task uses Picard's ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/360036510672"},"FastqToSam")," to convert the unmapped BAM to paired-end FASTQ files that can then be used for adapter clipping. This step also removes reads that fail to pass platform/vendor quality checks performed by the sequencing platform and flagged with the corresponding ",(0,r.yg)("a",{parentName:"p",href:"https://broadinstitute.github.io/picard/explain-flags.html"},"SAM flag value"),"."),(0,r.yg)("h4",{id:"4-trim-adapters-and-polya-tails"},"4. Trim adapters and poly(A) tails"),(0,r.yg)("p",null,"After converting the uBAM to FASTQs, the workflow uses ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/OpenGene/fastp"},"fastp")," to trim sequencing adapters and poly(A) tails from the reads. This task requires an ",(0,r.yg)("a",{parentName:"p",href:"https://console.cloud.google.com/storage/browser/_details/gcp-public-data--broad-references/RNA/resources/Illumina_adapters.fasta;tab=live_object"},"adapter FASTA file")," containing the list of sequences to be trimmed and is publicly available in Broad's ",(0,r.yg)("a",{parentName:"p",href:"https://console.cloud.google.com/storage/browser/gcp-public-data--broad-references;tab=objects?prefix=&forceOnObjectsSortingFiltering=false"},"public reference bucket"),"."),(0,r.yg)("p",null,"The adapter FASTA file contains the sequences shown below."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},">Illumina TruSeq Adapter Read 1\nAGATCGGAAGAGCACACGTCTGAACTCCAGTCA\n>Illumina TruSeq Adapter Read 2\nAGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGT\n>polyA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n")),(0,r.yg)("h4",{id:"5-convert-fastqs-to-ubam"},"5. Convert FASTQs to uBAM"),(0,r.yg)("p",null,"The ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/blob/master/tasks/broad/RNAWithUMIsTasks.wdl"},"tasks.FastqToUbam (alias = FastqToUbamAfterClipping)")," task converts trimmed FASTQs to an unmapped BAM using Picard's ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/360036510672"},"FastqToSam"),"."),(0,r.yg)("h4",{id:"6-alignment-with-star"},"6. Alignment with STAR"),(0,r.yg)("p",null,"After UMI extraction, the workflow aligns the paired-end reads to the reference (hg38 or hg19) using the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/alexdobin/STAR"},"STAR aligner"),', which is specifically designed for RNA-seq data and can align cDNA sequences with many "gaps" that correspond to introns. '),(0,r.yg)("p",null,"The task uses the following parameters:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Parameter"),(0,r.yg)("th",{parentName:"tr",align:null},"Value"),(0,r.yg)("th",{parentName:"tr",align:null},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"outSAMunmapped"),(0,r.yg)("td",{parentName:"tr",align:null},"Within"),(0,r.yg)("td",{parentName:"tr",align:null},"Includes unmapped reads in the output file rather than dropping those reads to facilitate potential downstream analysis.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"outFilterMismatchNoverLmax"),(0,r.yg)("td",{parentName:"tr",align:null},"0.1"),(0,r.yg)("td",{parentName:"tr",align:null},"Sets the maximum allowable ratio of mismatches to read length. Reads with a ratio larger than the set value are filtered. For example, for paired-end reads with length 146, the reads are filtered if the number of mismatches is greater than 29 (146 ","*"," 2 ","*"," 0.1 = 29).")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"alignEndsProtrude"),(0,r.yg)("td",{parentName:"tr",align:null},"20 ConcordantPair"),(0,r.yg)("td",{parentName:"tr",align:null},"Allows a maximum of 20 protruding bases at alignment ends and marks these alignments as concordant pairs to prevent reads from small cDNA fragments that were sequenced into adapters from being dropped. This parameter allows for the processing of data derived from low-quality or degraded tissue such as formalin-fixed paraffin-embedded (FFPE) samples.")))),(0,r.yg)("p",null,"Additional parameters are used to match ",(0,r.yg)("a",{parentName:"p",href:"https://www.encodeproject.org/data-standards/rna-seq/long-rnas/"},"ENCODE bulk RNA-seq data standards"),". To learn more about ENCODE options in STAR, see the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/alexdobin/STAR/blob/master/doc/STARmanual.pdf"},"STAR manual"),"."),(0,r.yg)("p",null,"After STAR alignment, the workflow outputs both a genome- and transcriptome-aligned BAM."),(0,r.yg)("h4",{id:"7-mark-duplicates-and-sort-bams"},"7. Mark duplicates and sort BAMs"),(0,r.yg)("p",null,"As described in Step 2 (UMI extraction), UMIs are DNA tags that allow us to distinguish between PCR duplicates (duplicate reads with the same UMI) and biological duplicates (duplicate reads with different UMIs)."),(0,r.yg)("p",null,"In this step, the workflow sorts the aligned BAMs coordinates using Picard's ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/360036510732-SortSam-Picard-"},"SortSam")," tool and then groups the duplicates using UMI-tools' ",(0,r.yg)("a",{parentName:"p",href:"https://umi-tools.readthedocs.io/en/latest/reference/group.html#"},"group")," function. Once the duplicates are grouped by UMI, the PCR duplicates are marked using Picard's ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/360037052812-MarkDuplicates-Picard-"},"MarkDuplicates"),". This step outputs new genome- and transcriptome-aligned BAM files with PCR duplicates tagged and a corresponding index file."),(0,r.yg)("p",null,"The transcriptome-aligned BAM is then sorted using GATK\u2019s ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/5358861221659-PostProcessReadsForRSEM-BETA-"},"PostProcessReadsForRSEM")," for compatibility with ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/deweylab/RSEM"},"RSEM"),". While RSEM is not used in this workflow, it is an additional tool that can be used to quantify expression from RNA-seq data."),(0,r.yg)("h4",{id:"8-gene-quantification"},"8. Gene quantification"),(0,r.yg)("p",null,"After duplicate reads have been tagged, the workflow uses ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/getzlab/rnaseqc"},"RNA-SeQC")," to quantify the expression level of transcripts based on the number of reads that align to one or more exons of each gene (",(0,r.yg)("inlineCode",{parentName:"p"},"rnaseqc2_gene_counts"),"). Exon-level expression is also quantified based on the number of reads that align to each exon (",(0,r.yg)("inlineCode",{parentName:"p"},"rnaseqc2_exon_counts"),"). "),(0,r.yg)("h4",{id:"9-metric-calculation"},"9. Metric calculation"),(0,r.yg)("p",null,"The pipeline uses ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/s-andrews/FastQC"},"FastQC"),",  ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/getzlab/rnaseqc"},"RNA-SeQC"),", Picard's ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/360037057492-CollectRnaSeqMetrics-Picard-"},"CollectRNASeqMetrics")," and ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/360037594031-CollectMultipleMetrics-Picard-"},"CollectMultipleMetrics")," tools, and GATK's ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/4418051471643-GetPileupSummaries"},"GetPileupSummaries")," and ",(0,r.yg)("a",{parentName:"p",href:"https://gatk.broadinstitute.org/hc/en-us/articles/4418054253211-CalculateContamination"},"CalculateContamination")," tools to calculate summary metrics that can be used to assess the quality of the data each time the pipeline is run. "),(0,r.yg)("p",null,"If you are a member of the Broad Institute's Genomics Platform using the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/blob/master/pipelines/broad/internal/rna_seq/BroadInternalRNAWithUMIs.wdl"},"internal RNA with UMIs pipeline"),", there is an additional step that merges the individual metrics files to create the ",(0,r.yg)("inlineCode",{parentName:"p"},"MergeMetrics.unified_metrics")," output file and prepare the data for use in the Terra Data Repository."),(0,r.yg)("h4",{id:"10-outputs"},"10. Outputs"),(0,r.yg)("p",null,"Workflow outputs are described in the table below. "),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Output variable name"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sample_name"),(0,r.yg)("td",{parentName:"tr",align:null},"Sample name extracted from the input unmapped BAM file header."),(0,r.yg)("td",{parentName:"tr",align:null},"String")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"transcriptome_bam"),(0,r.yg)("td",{parentName:"tr",align:null},"Duplicate-marked BAM file containing alignments from STAR translated into transcriptome coordinates and postprocessed for RSEM."),(0,r.yg)("td",{parentName:"tr",align:null},"BAM")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"transcriptome_duplicate_metrics"),(0,r.yg)("td",{parentName:"tr",align:null},"File containing duplication metrics."),(0,r.yg)("td",{parentName:"tr",align:null},"TXT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"output_bam"),(0,r.yg)("td",{parentName:"tr",align:null},"Duplicate-marked BAM file containing alignments from STAR translated into genome coordinates."),(0,r.yg)("td",{parentName:"tr",align:null},"BAM")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"output_bam_index"),(0,r.yg)("td",{parentName:"tr",align:null},"Index file for the output_bam output."),(0,r.yg)("td",{parentName:"tr",align:null},"BAM Index")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"duplicate_metrics"),(0,r.yg)("td",{parentName:"tr",align:null},"Duplicate metrics file containing the number of reads marked as duplicates."),(0,r.yg)("td",{parentName:"tr",align:null},"TXT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"rnaseqc2_gene_tpm"),(0,r.yg)("td",{parentName:"tr",align:null},"File containing TPMs."),(0,r.yg)("td",{parentName:"tr",align:null},"GCT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"rnaseqc2_gene_counts"),(0,r.yg)("td",{parentName:"tr",align:null},"File containing gene counts."),(0,r.yg)("td",{parentName:"tr",align:null},"GCT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"rnaseqc2_exon_counts"),(0,r.yg)("td",{parentName:"tr",align:null},"File containing exon counts."),(0,r.yg)("td",{parentName:"tr",align:null},"GCT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"rnaseqc2_fragment_size_histogram"),(0,r.yg)("td",{parentName:"tr",align:null},"File containing counts of observed fragment size."),(0,r.yg)("td",{parentName:"tr",align:null},"TXT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"rnaseqc2_metrics"),(0,r.yg)("td",{parentName:"tr",align:null},"File containing RNA-SeQC metrics including strand specificity, 3\u2019/5\u2019 bias, rRNA reads, and others."),(0,r.yg)("td",{parentName:"tr",align:null},"TSV")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_rna_metrics"),(0,r.yg)("td",{parentName:"tr",align:null},"Metrics file containing the output of Picard\u2019s CollectRnaSeqMetrics tool."),(0,r.yg)("td",{parentName:"tr",align:null},"TXT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_alignment_summary_metrics"),(0,r.yg)("td",{parentName:"tr",align:null},"Metrics file containing output of Picard\u2019s CollectAlignmentSummaryMetrics tool."),(0,r.yg)("td",{parentName:"tr",align:null},"TXT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_insert_size_metrics"),(0,r.yg)("td",{parentName:"tr",align:null},"Metrics file containing output of Picard\u2019s CollectInsertSizeMetrics tool."),(0,r.yg)("td",{parentName:"tr",align:null},"TXT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_insert_size_histogram"),(0,r.yg)("td",{parentName:"tr",align:null},"Histogram chart of insert size."),(0,r.yg)("td",{parentName:"tr",align:null},"PDF")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_base_distribution_by_cycle_metrics"),(0,r.yg)("td",{parentName:"tr",align:null},"Metrics file containing the output of Picard\u2019s CollectBaseDistributionByCycle tool."),(0,r.yg)("td",{parentName:"tr",align:null},"TXT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_base_distribution_by_cycle_pdf"),(0,r.yg)("td",{parentName:"tr",align:null},"Chart of nucleotide distribution per cycle."),(0,r.yg)("td",{parentName:"tr",align:null},"PDF")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_quality_by_cycle_metrics"),(0,r.yg)("td",{parentName:"tr",align:null},"Metrics file containing the output of Picard\u2019s MeanQualityByCycle tool."),(0,r.yg)("td",{parentName:"tr",align:null},"TXT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_quality_by_cycle_pdf"),(0,r.yg)("td",{parentName:"tr",align:null},"Chart of mean quality by cycle."),(0,r.yg)("td",{parentName:"tr",align:null},"PDF")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_quality_distribution_metrics"),(0,r.yg)("td",{parentName:"tr",align:null},"Metrics file containing the output of Picard\u2019s QualityScoreDistribution tool."),(0,r.yg)("td",{parentName:"tr",align:null},"TXT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"picard_quality_distribution_pdf"),(0,r.yg)("td",{parentName:"tr",align:null},"Chart of quality score distribution."),(0,r.yg)("td",{parentName:"tr",align:null},"PDF")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"contamination"),(0,r.yg)("td",{parentName:"tr",align:null},"Float representing the calculated cross-sample contamination."),(0,r.yg)("td",{parentName:"tr",align:null},"Float")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"contamination_error"),(0,r.yg)("td",{parentName:"tr",align:null},"Float representing the error associated with the contamination calculation."),(0,r.yg)("td",{parentName:"tr",align:null},"Float")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"fastqc_html_report"),(0,r.yg)("td",{parentName:"tr",align:null},"HTML report containing general quality control metrics generated by FastQC."),(0,r.yg)("td",{parentName:"tr",align:null},"File")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"fastqc_percent_reads_with_adapter"),(0,r.yg)("td",{parentName:"tr",align:null},"Float representing the percent of reads with adapter sequences present following the adapter clipping task."),(0,r.yg)("td",{parentName:"tr",align:null},"Float")))),(0,r.yg)("h2",{id:"versioning"},"Versioning"),(0,r.yg)("p",null,"All RNA with UMIs pipeline releases are documented in the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/blob/master/pipelines/broad/rna_seq/RNAWithUMIsPipeline.changelog.md"},"pipeline changelog"),"."),(0,r.yg)("h2",{id:"citing-the-rna-with-umis-pipeline"},"Citing the RNA with UMIs Pipeline"),(0,r.yg)("p",null,"If you use the RNA with UMIs Pipeline in your research, please consider citing our preprint:"),(0,r.yg)("p",null,"Degatano, K.; Awdeh, A.; Dingman, W.; Grant, G.; Khajouei, F.; Kiernan, E.; Konwar, K.; Mathews, K.; Palis, K.; Petrillo, N.; Van der Auwera, G.; Wang, C.; Way, J.; Pipelines, W. WDL Analysis Research Pipelines: Cloud-Optimized Workflows for Biological Data Processing and Reproducible Analysis. Preprints 2024, 2024012131. ",(0,r.yg)("a",{parentName:"p",href:"https://doi.org/10.20944/preprints202401.2131.v1"},"https://doi.org/10.20944/preprints202401.2131.v1")),(0,r.yg)("h2",{id:"feedback"},"Feedback"),(0,r.yg)("p",null,"Please help us make our tools better by ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/broadinstitute/warp/issues"},"filing an issue in WARP"),"; we welcome pipeline-related suggestions or questions."))}m.isMDXComponent=!0},7492:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/rna-with-umis_diagram-bce76bb42e6044bea0ff32d184622560.png"}}]);