<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Pipelines/Optimus_Pipeline/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Optimus Overview | WARP</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://broadinstitute.github.io/warp/docs/Pipelines/Optimus_Pipeline/README"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Optimus Overview | WARP"><meta data-rh="true" name="description" content="| Pipeline Version | Date Updated | Documentation Author | Questions or Feedback |"><meta data-rh="true" property="og:description" content="| Pipeline Version | Date Updated | Documentation Author | Questions or Feedback |"><link data-rh="true" rel="icon" href="/warp/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://broadinstitute.github.io/warp/docs/Pipelines/Optimus_Pipeline/README"><link data-rh="true" rel="alternate" href="https://broadinstitute.github.io/warp/docs/Pipelines/Optimus_Pipeline/README" hreflang="en"><link data-rh="true" rel="alternate" href="https://broadinstitute.github.io/warp/docs/Pipelines/Optimus_Pipeline/README" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BX0CVVQ6KQ-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/warp/blog/rss.xml" title="WARP RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/warp/blog/atom.xml" title="WARP Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NZ4BLRHQYS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-NZ4BLRHQYS",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="WARP" href="/warp/opensearch.xml">
<script>!function(t,h,e,j,s,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:2427684,hjsv:6},s=h.getElementsByTagName("head")[0],(n=h.createElement("script")).async=1,n.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,s.appendChild(n)}(window,document)</script><link rel="stylesheet" href="/warp/assets/css/styles.ddc3fdb8.css">
<link rel="preload" href="/warp/assets/js/runtime~main.a2ee2c75.js" as="script">
<link rel="preload" href="/warp/assets/js/main.435ed8cb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/warp/"><b class="navbar__title text--truncate">WARP Pipelines</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/warp/docs/get-started">Documentation</a><a class="navbar__item navbar__link" href="/warp/blog">Blog</a><a href="https://github.com/broadinstitute/warp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/warp/docs/get-started">Welcome to WARP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/warp/docs/About_WARP/BestPractices">About WARP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/warp/docs/Pipelines/ATAC/README">WARP Pipelines</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/ATAC/README">ATAC</a><button aria-label="Toggle the collapsible sidebar category &#x27;ATAC&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/BuildIndices_Pipeline/README">BuildIndices</a><button aria-label="Toggle the collapsible sidebar category &#x27;BuildIndices&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/Exome_Germline_Single_Sample_Pipeline/README">Exome Germline Single Sample</a><button aria-label="Toggle the collapsible sidebar category &#x27;Exome Germline Single Sample&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/Illumina_Genotyping_Arrays_Pipeline/README">Illumina Genotyping Array</a><button aria-label="Toggle the collapsible sidebar category &#x27;Illumina Genotyping Array&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/ImputationBeagle_Pipeline/README">ImputationBeagle</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/Imputation_Pipeline/README">Imputation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Imputation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/JointGenotyping_Pipeline/README">JointGenotyping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/Multiome_Pipeline/README">Multiome scATAC and GEX</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" tabindex="0" href="/warp/docs/Pipelines/Optimus_Pipeline/README">Optimus</a><button aria-label="Toggle the collapsible sidebar category &#x27;Optimus&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/Optimus_Pipeline/optimus.methods">Optimus v7.8.1 Methods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/Optimus_Pipeline/Bam_tags">What tags are included in an Optimus BAM file?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/Optimus_Pipeline/Loom_schema">Optimus Count Matrix Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/Optimus_Pipeline/Library-metrics">Optimus Library-level metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/Optimus_Pipeline/consortia-processing">Consortia Data Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/Optimus_Pipeline/starsolo-metrics">STAR Aligner Metrics</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/PairedTag_Pipeline/README">Paired-Tag</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/RNA_with_UMIs_Pipeline/README">RNA with UMIs</a><button aria-label="Toggle the collapsible sidebar category &#x27;RNA with UMIs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/SlideSeq_Pipeline/README">Slide-seq</a><button aria-label="Toggle the collapsible sidebar category &#x27;Slide-seq&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/SlideTags_Pipeline/README">Slide-tags</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/Smart-seq2_Single_Nucleus_Multi_Sample_Pipeline/README">Smart-seq2 Single Nucleus Multi-Sample</a><button aria-label="Toggle the collapsible sidebar category &#x27;Smart-seq2 Single Nucleus Multi-Sample&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/snm3C/README">Single Nucleus Methyl-Seq and Chromatin Capture</a><button aria-label="Toggle the collapsible sidebar category &#x27;Single Nucleus Methyl-Seq and Chromatin Capture&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/warp/docs/Pipelines/Ultima_Genomics_Whole_Genome_Germline_Pipeline/README">Ultima Genomics Whole Genome Germline</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/warp/docs/Pipelines/Whole_Genome_Germline_Single_Sample_Pipeline/README">Whole Genome Germline Single Sample</a><button aria-label="Toggle the collapsible sidebar category &#x27;Whole Genome Germline Single Sample&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/warp/docs/Best_practices/GC_cost_optimization">WDL Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/warp/docs/Pipelines/CEMBA_MethylC_Seq_Pipeline/README">Deprecated Pipelines</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/warp/docs/contribution/README">Contribution Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;Contribution Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/warp/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">WARP Pipelines</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Optimus</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Optimus Overview</h1><table><thead><tr><th align="center">Pipeline Version</th><th align="center">Date Updated</th><th align="center">Documentation Author</th><th align="center">Questions or Feedback</th></tr></thead><tbody><tr><td align="center"><a href="https://github.com/broadinstitute/warp/releases?q=optimus&amp;expanded=true" target="_blank" rel="noopener noreferrer">optimus_v8.0.0</a></td><td align="center">February, 2025</td><td align="center">WARP Pipelines</td><td align="center">Please <a href="https://github.com/broadinstitute/warp/issues" target="_blank" rel="noopener noreferrer">file an issue in WARP</a></td></tr></tbody></table><p><img loading="lazy" alt="Optimus_diagram" src="/warp/assets/images/Optimus_diagram-562f991cfdd1e4ac87221d292daa2a60.png" width="1095" height="1675" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-to-the-optimus-workflow">Introduction to the Optimus workflow<a href="#introduction-to-the-optimus-workflow" class="hash-link" aria-label="Direct link to Introduction to the Optimus workflow" title="Direct link to Introduction to the Optimus workflow">​</a></h2><p>Optimus is an open-source, cloud-optimized pipeline developed by the Data Coordination Platform (DCP) of the <a href="https://data.humancellatlas.org/" target="_blank" rel="noopener noreferrer">Human Cell Atlas (HCA) Project</a> as well as the <a href="https://biccn.org/" target="_blank" rel="noopener noreferrer">BRAIN Initiative Cell Census Network</a> (BICCN; see <a href="#acknowledgements">Acknowledgements</a> below). It supports the processing of any 3&#x27; single-cell and single-nucleus count data generated with the <a href="https://www.10xgenomics.com/solutions/single-cell/" target="_blank" rel="noopener noreferrer">10x Genomics v2 or v3 assay</a>.</p><p>It is an alignment and transcriptome quantification pipeline that corrects cell barcodes (CBs), aligns reads to the genome, corrects Unique Molecular Identifiers (UMIs), generates a count matrix in a UMI-aware manner, calculates summary metrics for genes and cells, detects empty droplets, returns read outputs in BAM format, and returns cell gene counts in numpy matrix and h5ad file formats.</p><p>In addition to providing <a href="/warp/docs/Pipelines/Optimus_Pipeline/Loom_schema">cell-level</a> and <a href="/warp/docs/Pipelines/Optimus_Pipeline/Library-metrics">library-level</a> metrics, Optimus takes special care to <strong>keep all reads in the output BAM that may be useful to the downstream user</strong>, such as unaligned reads or reads with uncorrectable barcodes. This design provides flexibility to the downstream user and allows for alternative filtering or leveraging the data for novel methodological development.</p><p>Optimus has been validated for analyzing both human and mouse single-cell or single-nucleus datasets. Learn more in the <a href="#validation-against-cell-ranger">validation section</a>.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Want to use the Optimus pipeline for your publication?</div><div class="admonitionContent_S0QG"><p>Check out the <a href="/warp/docs/Pipelines/Optimus_Pipeline/optimus.methods">Optimus Publication Methods</a> to get started!</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quickstart-table">Quickstart table<a href="#quickstart-table" class="hash-link" aria-label="Direct link to Quickstart table" title="Direct link to Quickstart table">​</a></h2><p>The following table provides a quick glance at the Optimus pipeline features:</p><table><thead><tr><th>Pipeline features</th><th>Description</th><th>Source</th></tr></thead><tbody><tr><td>Assay type</td><td>10x single cell or single nucleus expression (v2 and v3)</td><td><a href="https://www.10xgenomics.com" target="_blank" rel="noopener noreferrer">10x Genomics</a></td></tr><tr><td>Overall workflow</td><td>Quality control module and transcriptome quantification module</td><td>Code available from <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/Optimus.wdl" target="_blank" rel="noopener noreferrer">GitHub</a></td></tr><tr><td>Workflow language</td><td>WDL 1.0</td><td><a href="https://github.com/openwdl/wdl" target="_blank" rel="noopener noreferrer">openWDL</a></td></tr><tr><td>Genomic Reference Sequence</td><td>GRCh38.p13 (v43) human genome primary sequence and GRCm39 (M32) mouse genome primary sequence</td><td>GENCODE <a href="https://www.gencodegenes.org/human/release_43.html" target="_blank" rel="noopener noreferrer">human reference files</a> and <a href="https://www.gencodegenes.org/mouse/release_M32.html" target="_blank" rel="noopener noreferrer">mouse reference files</a></td></tr><tr><td>Transcriptomic reference annotation</td><td>V43 GENCODE human transcriptome and M32 mouse transcriptome</td><td>GENCODE <a href="https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_43/gencode.v43.annotation.gtf.gz" target="_blank" rel="noopener noreferrer">human GTF</a> and <a href="https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_mouse/release_M32/gencode.vM32.annotation.gtf.gz" target="_blank" rel="noopener noreferrer">mouse GTF</a></td></tr><tr><td>Aligner and transcript quantification</td><td>STARsolo</td><td><a href="https://www.biorxiv.org/content/10.1101/2021.05.05.442755v1" target="_blank" rel="noopener noreferrer">Dobin, et al.,2021</a></td></tr><tr><td>Data input file format</td><td>File format in which sequencing data is provided</td><td><a href="https://academic.oup.com/nar/article/38/6/1767/3112533" target="_blank" rel="noopener noreferrer">FASTQ</a></td></tr><tr><td>Data output file format</td><td>File formats in which Optimus output is provided</td><td></td></tr><tr><td><a href="http://samtools.github.io/hts-specs/" target="_blank" rel="noopener noreferrer">BAM</a>, Python numpy arrays (internal), h5ad</td><td></td><td></td></tr><tr><td>Library-level metrics</td><td>Library-level metrics produced by the Optimus workflow</td><td><a href="https://github.com/broadinstitute/warp/blob/develop/website/docs/Pipelines/Optimus_Pipeline/Library-metrics.md" target="_blank" rel="noopener noreferrer">Library-level metrics</a></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="set-up">Set-up<a href="#set-up" class="hash-link" aria-label="Direct link to Set-up" title="Direct link to Set-up">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optimus-installation">Optimus installation<a href="#optimus-installation" class="hash-link" aria-label="Direct link to Optimus installation" title="Direct link to Optimus installation">​</a></h3><p>To download the latest Optimus release, see the release tags prefixed with &quot;Optimus&quot; on the WARP <a href="https://github.com/broadinstitute/warp/releases" target="_blank" rel="noopener noreferrer">releases page</a>. All Optimus pipeline releases are documented in the <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/Optimus.changelog.md" target="_blank" rel="noopener noreferrer">Optimus changelog</a>. </p><p>To discover and search releases, use the WARP command-line tool <a href="https://github.com/broadinstitute/warp/tree/master/wreleaser" target="_blank" rel="noopener noreferrer">Wreleaser</a>.</p><p>If you’re running an Optimus workflow version prior to the latest release, the accompanying documentation for that release may be downloaded with the source code on the WARP <a href="https://github.com/broadinstitute/warp/releases" target="_blank" rel="noopener noreferrer">releases page</a> (see the source code folder <code>website/docs/Pipelines/Optimus_Pipeline</code>).</p><p>Optimus can be deployed using <a href="https://cromwell.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">Cromwell</a>, a GA4GH-compliant, flexible workflow management system that supports multiple computing platforms. The workflow can also be run in <a href="https://app.terra.bio" target="_blank" rel="noopener noreferrer">Terra</a>, a cloud-based analysis platform. The Terra <a href="https://app.terra.bio/#workspaces/featured-workspaces-hca/HCA_Optimus_Pipeline" target="_blank" rel="noopener noreferrer">Optimus Featured Workspace</a> contains the Optimus workflow, workflow configurations, required reference data and other inputs, and example testing data.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inputs">Inputs<a href="#inputs" class="hash-link" aria-label="Direct link to Inputs" title="Direct link to Inputs">​</a></h3><p>Optimus pipeline inputs are detailed in JSON format configuration files. There are five downsampled example configuration files available for running the pipeline:</p><ul><li><a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/human_v2_example.json" target="_blank" rel="noopener noreferrer">human_v2_example</a>: An example human 10x v2 single-cell dataset</li><li><a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/human_v3_example.json" target="_blank" rel="noopener noreferrer">human_v3_example</a>: An example human 10x v3 single-cell dataset</li><li><a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/mouse_v2_example.json" target="_blank" rel="noopener noreferrer">mouse_v2_example</a>: An example mouse 10x v2 single-cell dataset</li><li><a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/mouse_v2_snRNA_example.json" target="_blank" rel="noopener noreferrer">mouse_v2_snRNA_example</a>: An example mouse v2 single-nucleus dataset</li></ul><p>Additionally, there are multiple full-size example datasets available in the Optimus <a href="https://github.com/broadinstitute/warp/tree/master/pipelines/wdl/optimus/example_inputs" target="_blank" rel="noopener noreferrer"><code>example_inputs</code></a> folder. Unlike the example configuration files above, the full-size configuration files may not reflect updated Optimus parameters. However, you can still access the FASTQ files for each dataset at the Google bucket locations listed in the dataset configuration files.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample-data-input">Sample data input<a href="#sample-data-input" class="hash-link" aria-label="Direct link to Sample data input" title="Direct link to Sample data input">​</a></h4><p>Each 10x v2 and v3 3’ sequencing experiment generates triplets of FASTQ files for any given sample. Optimus takes the FASTQs listed below as input.</p><ol><li>Forward reads (<code>r1_fastq</code>) containing the unique molecular identifier (UMI) and CB sequences</li><li>Reverse reads (<code>r2_fastq</code>) containing the alignable genomic information from the mRNA transcript</li><li>Optional index FASTQ (<code>i1_fastq</code>) containing the sample barcodes, when provided by the sequencing facility</li></ol><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Optimus is currently a single sample pipeline</div><div class="admonitionContent_S0QG"><p>However, it can take in multiple sets of FASTQs for a sample that has been split over multiple lanes of sequencing. For an example configuration file with multiple lanes, please see the <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/mouse_v2_example.json" target="_blank" rel="noopener noreferrer">mouse_v2_example.json</a>. Additionally, Optimus does not support demultiplexing even though it accepts index FASTQ files.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="additional-reference-inputs">Additional reference inputs<a href="#additional-reference-inputs" class="hash-link" aria-label="Direct link to Additional reference inputs" title="Direct link to Additional reference inputs">​</a></h4><p>The example configuration files also contain metadata for the reference files, described in the table below.</p><table><thead><tr><th>Parameter name</th><th>Description</th><th>Optional attributes (when applicable)</th></tr></thead><tbody><tr><td>cloud_provider</td><td>String describing the cloud provider that should be used to run the workflow; value should be &quot;gcp&quot; or &quot;azure&quot;.</td><td>String</td></tr><tr><td>whitelist</td><td>List of known CBs; the workflow automatically selects the <a href="https://www.10xgenomics.com/" target="_blank" rel="noopener noreferrer">10x Genomics</a> whitelist that corresponds to the v2 or v3 chemistry based on the input <code>tenx_chemistry_version</code>. A custom whitelist can also be provided if the input data was generated with a chemistry different from 10x Genomics v2 or v3. To use a custom whitelist, set the input <code>ignore_r1_read_length</code> to &quot;true&quot;.</td><td>N/A</td></tr><tr><td>read_struct</td><td>String describing the structure of reads; the workflow automatically selects the <a href="https://www.10xgenomics.com/" target="_blank" rel="noopener noreferrer">10x Genomics</a> read structure that corresponds to the v2 or v3 chemistry based on the input <code>tenx_chemistry_version</code>. A custom read structure can also be provided if the input data was generated with a chemistry different from 10x Genomics v2 or v3. To use a custom read structure, set the input <code>force_no_check</code> to &quot;true&quot;.</td><td>N/A</td></tr><tr><td>tar_star_reference</td><td>TAR file containing a species-specific reference genome and GTF; it is generated using the <a href="https://github.com/broadinstitute/warp/tree/master/pipelines/wdl/build_indices/BuildIndices.wdl" target="_blank" rel="noopener noreferrer">BuildIndices workflow</a>.</td><td>N/A</td></tr><tr><td>input_id</td><td>Unique identifier describing the biological sample or replicate that corresponds with the FASTQ files; can be a human-readable name or UUID.</td><td>N/A</td></tr><tr><td>gex_nhash_id</td><td>Optional string to identify the library aliquot; will be echoed in the output h5ad file in the adata.uns and the library-level metrics CSV; default is null (<code>&quot;&quot;</code>)</td><td>N/A</td></tr><tr><td>input_name</td><td>Optional string that can be used to further identify the original biological sample.</td><td>N/A</td></tr><tr><td>input_id_metadata_field</td><td>Optional string describing, when applicable, the metadata field containing the input_id.</td><td>N/A</td></tr><tr><td>input_name_metadata_field</td><td>Optional string describing, when applicable, the metadata field containing the input_name.</td><td>N/A</td></tr><tr><td>annotations_gtf</td><td>GTF containing gene annotations used for gene tagging (must match GTF in STAR reference).</td><td>N/A</td></tr><tr><td>tenx_chemistry_version</td><td>Integer that specifies if data was generated with 10x v2 or v3 chemistry. Optimus validates this chemistry by examining the UMIs and CBs in the first read 1 FASTQ file. If the chemistry does not match, the pipeline will fail. You can remove the check by setting &quot;ignore_r1_read_length = true&quot; in the input JSON.</td><td>2 or 3</td></tr><tr><td>mt_genes</td><td>Optional file containing mitochondrial gene names for a specific species. This is used for calculating gene metrics.</td><td>N/A</td></tr><tr><td>soloMultiMappers</td><td>Optional string describing whether or not the Optimus (GEX) pipeline should run STARsolo with the <code>--soloMultiMappers</code> flag; default is &quot;Uniform&quot;.</td><td>N/A</td></tr><tr><td>counting_mode</td><td>String describing whether data is single-cell or single-nucleus. Single-cell mode counts reads aligned to the gene transcript, whereas single-nucleus counts whole transcript to account for nuclear pre-mRNA.</td><td>&quot;sc_rna&quot; or &quot;sn_rna&quot;</td></tr><tr><td>output_bam_basename</td><td>String used as a basename for output BAM file; the default is set to the string used for the <code>input_id</code> parameter.</td><td>N/A</td></tr><tr><td>star_strand_mode</td><td>Optional string for running the workflow on forward stranded, reverse stranded, or unstranded data; default is &quot;Forward&quot;.</td><td>&quot;Forward&quot; (default), &quot;Reverse&quot;, and &quot;Unstranded&quot;</td></tr><tr><td>ignore_r1_read_length</td><td>Boolean that overrides a check on the 10x chemistry. Default is set to false. If true, the workflow will not ensure that the 10x_chemistry_version input matches the chemistry in the read 1 FASTQ.</td><td>&quot;true&quot; or &quot;false&quot; (default)</td></tr><tr><td>emptydrops_lower</td><td>UMI threshold for emptyDrops detection; default is 100.</td><td>N/A</td></tr><tr><td>count_exons</td><td>Boolean indicating if the workflow should calculate exon counts <strong>when in single-nucleus (sn_rna) mode</strong>. If true, this option will output an additional layer for the h5ad file. By default, it is set to &quot;false&quot;. If the parameter is true and used with sc_rnamode, the workflow will return an error.</td><td>&quot;true&quot; or &quot;false&quot; (default)</td></tr><tr><td>gex_expected_cells</td><td>Optional integer input for the expected number of cells, which is used calculate library-level metrics. The default is set to 3,000.</td><td>N/A</td></tr><tr><td>run_cellbender</td><td>Optional boolean used to determine if the Optimus (GEX) pipeline should run CellBender on the output gene expression h5ad file, <code>h5ad_output_file_gex</code>; default is &quot;false&quot;.</td><td>Boolean</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pseudogene-handling">Pseudogene handling<a href="#pseudogene-handling" class="hash-link" aria-label="Direct link to Pseudogene handling" title="Direct link to Pseudogene handling">​</a></h4><p>The example Optimus reference files are downloaded directly from GENCODE (see Quickstart table) and are not modified to remove pseudogenes. This is in contrast to the <a href="https://support.10xgenomics.com/single-cell-multiome-atac-gex/software/release-notes/references#header" target="_blank" rel="noopener noreferrer">references created for Cell Ranger</a> which remove pseudogenes and small RNAs.</p><p>In the case of multi-mapped pseudogenes, Optimus and Cell Ranger will produce different results. Optimus does not count multi-mapped reads in the final count matrix, whereas Cell Ranger will keep potential multi-mapped reads because it does not identify the pseudogene reads.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample-inputs-for-analyses-in-a-terra-workspace">Sample inputs for analyses in a Terra Workspace<a href="#sample-inputs-for-analyses-in-a-terra-workspace" class="hash-link" aria-label="Direct link to Sample inputs for analyses in a Terra Workspace" title="Direct link to Sample inputs for analyses in a Terra Workspace">​</a></h4><p>The Optimus pipeline is currently available on the cloud-based platform Terra. After registering, you can access the <a href="https://app.terra.bio/#workspaces/featured-workspaces-hca/HCA_Optimus_Pipeline" target="_blank" rel="noopener noreferrer">Optimus featured workspace</a>. The workspace is preloaded with instructions and sample data. Please view the <a href="https://support.terra.bio/hc/en-us" target="_blank" rel="noopener noreferrer">Support Center</a> for more information on using the Terra platform.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimus-tasks-and-tools">Optimus tasks and tools<a href="#optimus-tasks-and-tools" class="hash-link" aria-label="Direct link to Optimus tasks and tools" title="Direct link to Optimus tasks and tools">​</a></h2><p>The <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/Optimus.wdl" target="_blank" rel="noopener noreferrer">Optimus workflow</a> imports individual &quot;tasks,&quot; also written in  WDL script, from the WARP <a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl" target="_blank" rel="noopener noreferrer">tasks folder</a>. </p><p>Overall, the Optimus workflow:</p><ol><li>Checks inputs.</li><li>Corrects CBs, aligns reads, corrects UMIs, and counts genes with STAR.</li><li>Calculates gene metrics.</li><li>Calculates cell metrics.</li><li>Runs emptyDrops.</li><li>Merges gene counts, metrics, and emptyDrops data into a h5ad-formatted matrix.</li></ol><p>The tools each Optimus task employs are detailed in the table below. </p><p>To see specific tool parameters, select the task WDL link in the table; then view the <code>command {}</code> section of the task in the WDL script. To view or use the exact tool software, see the task&#x27;s Docker image which is specified in the task WDL <code># runtime values</code> section as <code>String docker =</code>.</p><table><thead><tr><th>Task name and WDL link</th><th>Tool</th><th>Software</th><th>Description</th></tr></thead><tbody><tr><td><a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/CheckInputs.wdl" target="_blank" rel="noopener noreferrer">OptimusInputChecks.checkOptimusInput</a></td><td>Custom script</td><td>Bash</td><td>Validates the tenx_chemistry_version and counting_mode inputs. For the tenx_chemistry_version, the script verifies that the length of the CBs and UMIs in the first read1 FASTQ file matches the length expected by 10x Genomics v2 and v3 chemistry. It then selects and outputs the appropriate whitelist to use for analysis in the rest of the workflow.</td></tr><tr><td><a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/StarAlign.wdl" target="_blank" rel="noopener noreferrer">StarAlign.STARsoloFastq (alias = STARsoloFastq)</a></td><td>STAR</td><td><a href="https://github.com/alexdobin/STAR" target="_blank" rel="noopener noreferrer">Star</a></td><td>Uses the FASTQ files to perform CB correction, adaptor trimming, alignment, gene annotation, UMI correction, and gene counting. Creates a compressed raw NPY or NPZ file containing the STARsolo output features (NPY), barcodes (NPZ) and counts (NPZ)</td></tr><tr><td><a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/Metrics.wdl" target="_blank" rel="noopener noreferrer">Metrics.CalculateGeneMetrics (alias = GeneMetrics)</a></td><td>TagSort</td><td><a href="https://github.com/broadinstitute/warp-tools" target="_blank" rel="noopener noreferrer">warp-tools</a></td><td>Sorts the BAM file by gene using the cell barcode (CB), molecule barcode (UB) and gene ID (GX) tags and computes gene metrics.</td></tr><tr><td><a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/Metrics.wdl" target="_blank" rel="noopener noreferrer">Metrics.CalculateCellMetrics (alias = CellMetrics)</a></td><td>TagSort</td><td><a href="https://github.com/broadinstitute/warp-tools" target="_blank" rel="noopener noreferrer">warp-tools</a></td><td>Sorts the BAM file by cell using the cell barcode (CB), molecule barcode (UB) and gene ID (GX) tags and computes cell metrics.</td></tr><tr><td><a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/RunEmptyDrops.wdl" target="_blank" rel="noopener noreferrer">RunEmptyDrops.RunEmptyDrops</a></td><td>npz2rds.sh, emptyDropsWrapper.R, emptyDrops</td><td><a href="https://bioconductor.org/packages/release/bioc/html/DropletUtils.html" target="_blank" rel="noopener noreferrer">DropletUtils</a></td><td>Runs custom scripts to convert the NPY and NPZ files to RDS and then uses emptyDrops to identify empty lipid droplets. This step only runs when <code>counting_mode</code> = &quot;sc_rna&quot;. This task is nondeterministic.</td></tr><tr><td><a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/H5adUtils.wdl" target="_blank" rel="noopener noreferrer">H5adUtils.OptimusH5adGeneration</a></td><td>create_h5ad_optimus.py</td><td>Python3</td><td>Merges the gene counts, cell metrics, gene metrics, and emptyDrops data into a h5ad formatted cell-by-gene matrix. The h5ad contains exon counts when using sc_rna mode, and whole-gene counts when running in sn_rna mode. It optionally contains an additional layer for exon counts when running sn_rna mode with <code>exon_counts</code> set to true. This task is nondeterministic.</td></tr><tr><td>CellBender.run_cellbender_remove_background_gpu as CellBender (<a href="https://raw.githubusercontent.com/broadinstitute/CellBender/v0.3.0/wdl/cellbender_remove_background.wdl" target="_blank" rel="noopener noreferrer">WDL</a>)</td><td>CellBender</td><td>Optional task that runs the <code>cellbender_remove_background.wdl</code> WDL script directly from the <a href="https://github.com/broadinstitute/CellBender/tree/master" target="_blank" rel="noopener noreferrer">CellBender GitHub repository</a>, depending on whether the input <code>run_cellbender</code> is &quot;true&quot; or &quot;false&quot;.</td><td></td></tr></tbody></table><p>More information about the different tags used to flag the data can be found in the <a href="/warp/docs/Pipelines/Optimus_Pipeline/Bam_tags">Bam_tags documentation</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-checks-inputs">1. Checks inputs<a href="#1-checks-inputs" class="hash-link" aria-label="Direct link to 1. Checks inputs" title="Direct link to 1. Checks inputs">​</a></h4><p>The <a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/CheckInputs.wdl" target="_blank" rel="noopener noreferrer">checkOptimusInput</a> task validates the <code>tenx_chemistry_version</code> and <code>counting_mode</code> inputs to ensure that the attributes are selected. For the <code>tenx_chemistry_version</code>, the script verifies that the length of the CBs and UMIs in the first read1 FASTQ file matches the length expected by 10x Genomics v2 and v3 chemistry. It then selects and outputs the appropriate whitelist to use for analysis in the rest of the workflow. For the <code>counting_mode</code> input, the task verifies that the input is set to either the string &quot;sc_rna&quot; or &quot;sn_rna&quot;. If these checks fail, the workflow will fail. </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-correct-cbs-trims-reads-align-annotate-genes-correct-umis-and-count-genes">2. Correct CBs, trims reads, align, annotate genes, correct UMIs, and count genes<a href="#2-correct-cbs-trims-reads-align-annotate-genes-correct-umis-and-count-genes" class="hash-link" aria-label="Direct link to 2. Correct CBs, trims reads, align, annotate genes, correct UMIs, and count genes" title="Direct link to 2. Correct CBs, trims reads, align, annotate genes, correct UMIs, and count genes">​</a></h4><p>The <a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/StarAlign.wdl" target="_blank" rel="noopener noreferrer">STARsoloFastq task</a> uses the FASTQ files to perform CB correction, alignment, gene annotation, and counting. </p><p><strong>CB correction</strong></p><p>Although the function of the CBs is to identify unique cells, barcode errors can arise during sequencing, such as the incorporation of the barcode into contaminating DNA or sequencing and PCR errors. This makes it difficult to distinguish unique cells from barcode artifacts. The STARsoloFastq task uses the STAR aligner to evaluate barcode errors by comparing the R1 FASTQ sequences against a 10x chemistry-specific whitelist of known barcode sequences. </p><p>Corrected barcodes are those that come within one edit distance (<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5410656/" target="_blank" rel="noopener noreferrer">Hamming  distance</a>) of matching the whitelist of barcode sequences. This is specified in the STAR parameter  <code>--soloCBmatchWLtype 1MM_multi_Nbase_pseudocounts</code>, which allows multiple matches in the whitelist with 1 mismatched base and uses posterior probability calculation to choose one of the matches. Additionally, it adds pseudocounts of 1 to all whitelist barcodes and allows multi-matching of CBs with N-bases to the whitelist.</p><p>Correct barcodes are assigned a “CB” tag in the BAM. Uncorrectable barcodes (with more than one error) are preserved and given a “CR” (Cell barcode Raw) tag. CB quality scores are also preserved in the file under the “CY” tag. </p><p><strong>Read trimming</strong></p><p>Read trimming removes Illumina adapter sequences. This is set to match the read trimming performed by CellRanger4 and is specified using the parameter <code>--clipAdapterType CellRanger4</code> and  <code>--outFilterScoreMin 30</code>.</p><p><strong>Alignment</strong></p><p>STAR maps barcoded reads to the genome primary assembly reference (see the Quickstart table above for version information). The example references for Optimus were generated using the <a href="https://github.com/broadinstitute/warp/tree/master/pipelines/wdl/build_indices/BuildIndices.wdl" target="_blank" rel="noopener noreferrer">BuildIndices workflow</a>. The strandedness for alignment is specified in STAR with the <code>--soloStrand</code> parameter, which is set to unstranded by default. </p><p><strong>Gene annotation</strong></p><p>Prior to gene counting, STARsolo adds gene annotations which will vary depending on the counting_mode (&quot;sc_rna&quot; or &quot;sn_rna&quot;) specified in the Optimus workflow. With <code>sc_rna</code>, STARsolo runs with the “Gene” COUNTING_MODE, which is specific to exons.  With the <code>sn_rna</code> mode, STARsolo runs the “GeneFull_Ex50pAS” COUNTING_MODE and has the additional option to run the &quot;Gene&quot; mode when the input parameter <code>count_exons</code> is set to &quot;true&quot;. </p><p>Genes that overlap an alignment are stored with the GX BAM tag; for sc_rna mode, this will include the gene that corresponds to an exon or UTR, whereas for sn_rna mode, this will include the gene corresponding to an exon, UTR, and intron.</p><p>All tags are detailed in the pipeline&#x27;s <a href="/warp/docs/Pipelines/Optimus_Pipeline/Bam_tags">BAM_tag documentation</a>.</p><p><strong>UMI correction and gene counting</strong></p><p>UMIs are designed to distinguish unique transcripts present in the cell at lysis from those arising from PCR amplification of these same transcripts. But, like CBs, UMIs can also be incorrectly sequenced or amplified. </p><p>By specifying the <code>--soloUMIdedup 1MM_Directional_UMItools</code>, STARsolo applies a network-based, &quot;directional&quot; correction method (<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5340976/" target="_blank" rel="noopener noreferrer">Smith, et al., 2017</a>) to account for such errors. Additionally, the UMI correction task requires the length of the UMI, which differs between v2 and v3 chemistry; v2 is 10 bp whereas v3 is 12 bp. The task will add a &#x27;UB&#x27; tag for UMI-corrected barcodes. </p><p>Deduplicated UMIs are counted towards their assigned gene/cells, producing a raw count matrix.</p><p><strong>STARsolo outputs</strong></p><p>The task’s output includes a coordinate-sorted BAM file containing the CB-corrected reads and SAM attributes UB UR UY CR CB CY NH GX GN. Additionally, after counting, the task outputs three intermediate TSV files (features, barcodes, and matrix) used for downstream empty droplet detection and h5ad matrix generation. The task also outputs a compressed raw NPY or NPZ file containing the STARsolo output features (NPY), barcodes (NPZ) and counts (NPZ).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-calculate-gene-metrics">3. Calculate gene metrics<a href="#3-calculate-gene-metrics" class="hash-link" aria-label="Direct link to 3. Calculate gene metrics" title="Direct link to 3. Calculate gene metrics">​</a></h4><p>The <a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/Metrics.wdl" target="_blank" rel="noopener noreferrer">CalculateGeneMetrics</a> task uses <a href="https://github.com/broadinstitute/warp-tools" target="_blank" rel="noopener noreferrer">warp-tools</a> to calculate summary metrics that help assess the quality of the data output each time this pipeline is run. These metrics are included in the output h5ad matrix. A detailed list of these metrics is found in the <a href="/warp/docs/Pipelines/Optimus_Pipeline/Loom_schema">Optimus Count Matrix Overview</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-calculate-cell-metrics">4. Calculate cell metrics<a href="#4-calculate-cell-metrics" class="hash-link" aria-label="Direct link to 4. Calculate cell metrics" title="Direct link to 4. Calculate cell metrics">​</a></h4><p>The <a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/Metrics.wdl" target="_blank" rel="noopener noreferrer">CalculateCellMetrics</a> task uses <a href="https://github.com/broadinstitute/warp-tools" target="_blank" rel="noopener noreferrer">warp-tools</a> to calculate summary metrics that help assess the per-cell quality of the data output each time this pipeline is run. These metrics are included in the output h5ad matrix. A detailed list of these metrics is found in the <a href="/warp/docs/Pipelines/Optimus_Pipeline/Loom_schema">Optimus Count Matrix Overview</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-run-emptydrops">5. Run emptyDrops<a href="#5-run-emptydrops" class="hash-link" aria-label="Direct link to 5. Run emptyDrops" title="Direct link to 5. Run emptyDrops">​</a></h4><p>Empty droplets are lipid droplets that did not encapsulate a cell during 10x sequencing, but instead acquired cell-free RNA (secreted RNA or RNA released during cell lysis) from the solution in which the cells resided (<a href="https://www.ncbi.nlm.nih.gov/pubmed/?term=30902100" target="_blank" rel="noopener noreferrer">Lun, et al., 2018</a>. This ambient RNA can serve as a substrate for reverse transcription, leading to a small number of background reads. The Optimus pipeline calls the <a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/RunEmptyDrops.wdl" target="_blank" rel="noopener noreferrer">RunEmptyDrops</a> task which uses the <a href="http://bioconductor.org/packages/release/bioc/html/DropletUtils.html" target="_blank" rel="noopener noreferrer">DropletUtils</a> R package to flag CBs that represent empty droplets rather than cells. A cell will be flagged if it contains fewer than 100 molecules.
emptyDrops metrics for single-cell data (not single-nucleus; see note below) are stored in the columns of the output h5ad matrix.  Read full details for all the metrics in the <a href="/warp/docs/Pipelines/Optimus_Pipeline/Loom_schema">Optimus Matrix Overview</a>.</p><p>EmptyDrops relies on a visual knee point inflection (described in <a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1662-y" target="_blank" rel="noopener noreferrer">Lun et al. (2019)</a>) to differentiate ambient-like cells from empty droplets. <strong>If the single-cell data (counting mode set to <code>sc_rna</code>) does not produce a knee point inflection when running emptyDrops, the h5ad columns for emptyDrops data will contain &quot;NA&quot;s.</strong></p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>RunEmptyDrops output not included for single-nucleus data</div><div class="admonitionContent_S0QG"><p>Often snRNAseq data does not produce a visual knee point inflection when running emptyDrops and the tool can not accurately distinguish ambient-like cells from empty droplets. For this reason, emptyDrops is not used if Optimus counting_mode is set to <code>sn_rna</code>, and the output h5ad matrix will not contain emptyDrops metrics.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="6--matrix-construction">6.  Matrix construction<a href="#6--matrix-construction" class="hash-link" aria-label="Direct link to 6.  Matrix construction" title="Direct link to 6.  Matrix construction">​</a></h4><p>The <a href="https://github.com/broadinstitute/warp/blob/master/tasks/wdl/H5adUtils.wdl" target="_blank" rel="noopener noreferrer">OptimusH5adGeneration</a> task uses a custom python script to merge the converted STARsolo count matrix, the emptyDrops results, and the cell and gene metrics into an h5ad-formatted cell-by-gene matrix. <strong>These counts are raw and unfiltered.</strong></p><p>Read full details for all the metrics in the <a href="/warp/docs/Pipelines/Optimus_Pipeline/Loom_schema">Optimus Count Matrix Overview</a>.</p><p>The type of gene counts in the h5ad will vary depending on the Optimus workflow counting_mode. If running single-cell data (sc_rna mode), the counts will include only exonic gene counts. </p><p>If running single-nucleus data (sn_rna mode), the counts in the main matrix will be whole transcript and, when <code>count_exons</code> is set to true, the counts in an additional layer will be exonic. Using the <code>count_exons</code> parameter will cause the h5ad matrix to have additional columns (cell barcodes) due to the difference in STARsolo counting mode.</p><p>You can determine which type of counts are in the h5ad by looking at the global attribute <code>expression_data_type</code>.</p><p>For sn_rna mode, you can also access whole transcript and exonic counts using AnnData alyers <code>layers()</code> method. For example, adata.layers<!-- -->[“exon_counts”]<!-- -->` will return the exonic counts from the output h5ad. </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="7-optional-run-cellbender">7. Optional: Run CellBender<a href="#7-optional-run-cellbender" class="hash-link" aria-label="Direct link to 7. Optional: Run CellBender" title="Direct link to 7. Optional: Run CellBender">​</a></h4><p>This task runs when the <code>run_cellbender</code> input is set to true. CellBender is a tool for removing background UMIs and thereby helps to flag empty drops. Learn more in the <a href="https://cellbender.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">CellBender documentation</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="8-outputs">8. Outputs<a href="#8-outputs" class="hash-link" aria-label="Direct link to 8. Outputs" title="Direct link to 8. Outputs">​</a></h4><p>Output files of the pipeline include:</p><ol><li>Cell x Gene unnormalized, but UMI-corrected, count matrices in h5ad format.</li><li>Unfiltered, sorted BAM file with barcode and downstream analysis <a href="/warp/docs/Pipelines/Optimus_Pipeline/Bam_tags">tags</a>.</li><li>Cell metadata, including cell metrics.</li><li>Gene metadata, including gene metrics.</li></ol><p>The following table lists the output files produced from the pipeline. For samples that have sequenced over multiple lanes, the pipeline will output one merged version of each listed file.</p><table><thead><tr><th>Output Variable Name</th><th>Filename, if applicable</th><th>Output Type</th><th>Output Format</th></tr></thead><tbody><tr><td>pipeline_version_out</td><td>N/A</td><td>Version of the processing pipeline run on this data.</td><td>String</td></tr><tr><td>genomic_reference_version</td><td>reference_version.txt</td><td>Genomic reference version</td><td>TXT</td></tr><tr><td>bam</td><td><code>&lt;input_id&gt;.bam</code></td><td>Aligned BAM</td><td>BAM</td></tr><tr><td>matrix</td><td><code>&lt;input_id&gt;_sparse_counts.npz</code></td><td>Converted sparse matrix file from the Starsolo task.</td><td>NPZ</td></tr><tr><td>matrix_row_index</td><td><code>&lt;input_id&gt;_sparse_counts_row_index.npy</code></td><td>Index of cells in count matrix.</td><td>NPY</td></tr><tr><td>matrix_col_index</td><td><code>&lt;input_id&gt;_sparse_counts_col_index.npy</code></td><td>Index of genes in count matrix.</td><td>NPY</td></tr><tr><td>cell_metrics</td><td><code>&lt;input_id&gt;.cell-metrics.csv.gz</code></td><td>Matrix of metrics by cells.</td><td>Compressed CSV</td></tr><tr><td>gene_metrics</td><td><code>&lt;input_id&gt;.gene-metrics.csv.gz</code></td><td>Matrix of metrics by genes.</td><td>Compressed CSV</td></tr><tr><td>aligner_metrics</td><td><code>&lt;input_id&gt;.star_metrics.tar</code></td><td>Tarred metrics files produced by the STARsolo aligner; contains align features, cell reads, summary, and UMI per cell metrics files. See the <a href="/warp/docs/Pipelines/Optimus_Pipeline/starsolo-metrics">STARsolo metrics</a> for more information about these files.</td><td>TXT</td></tr><tr><td>library_metrics</td><td><code>&lt;input_id&gt;_&lt;gex_nash_id&gt;_library_metrics.csv</code></td><td>Optional CSV file containing all library-level metrics calculated with STARsolo for gene expression data. See the <a href="/warp/docs/Pipelines/Optimus_Pipeline/Library-metrics">Library-level metrics</a> for how metrics are calculated.</td><td>CSV</td></tr><tr><td>multimappers_EM_matrix</td><td><code>UniqueAndMult-EM.mtx</code></td><td>Optional output produced when <code>soloMultiMappers</code> is &quot;EM&quot;; see STARsolo <a href="https://github.com/alexdobin/STAR/blob/master/docs/STARsolo.md#multi-gene-reads" target="_blank" rel="noopener noreferrer">documentation</a> for more information.</td><td>MTX</td></tr><tr><td>multimappers_Uniform_matrix</td><td><code>UniqueAndMult-Uniform.mtx</code></td><td>Optional output produced when <code>soloMultiMappers</code> is &quot;Uniform&quot;; see STARsolo <a href="https://github.com/alexdobin/STAR/blob/master/docs/STARsolo.md#multi-gene-reads" target="_blank" rel="noopener noreferrer">documentation</a> for more information.</td><td>MTX</td></tr><tr><td>multimappers_Rescue_matrix</td><td><code>UniqueAndMult-Rescue.mtx</code></td><td>Optional output produced when <code>soloMultiMappers</code> is &quot;Rescue&quot;; see STARsolo <a href="https://github.com/alexdobin/STAR/blob/master/docs/STARsolo.md#multi-gene-reads" target="_blank" rel="noopener noreferrer">documentation</a> for more information.</td><td>MTX</td></tr><tr><td>multimappers_PropUnique_matrix</td><td><code>UniqueAndMult-PropUnique.mtx</code></td><td>Optional output produced when <code>soloMultiMappers</code> is &quot;PropUnique&quot;; see STARsolo <a href="https://github.com/alexdobin/STAR/blob/master/docs/STARsolo.md#multi-gene-reads" target="_blank" rel="noopener noreferrer">documentation</a> for more information.</td><td>MTX</td></tr><tr><td>cell_calls</td><td>empty_drops_result.csv</td><td>emptyDrops results from the RunEmptyDrops task.</td><td>CSV</td></tr><tr><td>h5ad_output_file</td><td><code>&lt;input_id&gt;.h5ad</code></td><td>h5ad file with count data (exonic or whole transcript depending on the counting_mode) and metadata.</td><td>H5AD</td></tr><tr><td>mtx_files</td><td><code>&lt;input_id&gt;.mtx_files.tar</code></td><td>TAR file with STARsolo matrix market files (barcodes.tsv, features.tsv, and matrix.mtx)</td><td>TAR</td></tr><tr><td>cell_barcodes_csv</td><td><code>&lt;cell_csv&gt;</code></td><td>Optional output produced when <code>run_cellbender</code> is &quot;true&quot;; see CellBender <a href="https://cellbender.readthedocs.io/en/latest/usage/index.html" target="_blank" rel="noopener noreferrer">documentation</a> and <a href="https://github.com/broadinstitute/CellBender/tree/master" target="_blank" rel="noopener noreferrer">GitHub repository</a> for more information.</td><td></td></tr><tr><td>checkpoint_file</td><td><code>&lt;ckpt_file&gt;</code></td><td>Optional output produced when <code>run_cellbender</code> is &quot;true&quot;; see CellBender <a href="https://cellbender.readthedocs.io/en/latest/usage/index.html" target="_blank" rel="noopener noreferrer">documentation</a> and <a href="https://github.com/broadinstitute/CellBender/tree/master" target="_blank" rel="noopener noreferrer">GitHub repository</a> for more information.</td><td></td></tr><tr><td>h5_array</td><td><code>&lt;h5_array&gt;</code></td><td>Optional output produced when <code>run_cellbender</code> is &quot;true&quot;; see CellBender <a href="https://cellbender.readthedocs.io/en/latest/usage/index.html" target="_blank" rel="noopener noreferrer">documentation</a> and <a href="https://github.com/broadinstitute/CellBender/tree/master" target="_blank" rel="noopener noreferrer">GitHub repository</a> for more information.</td><td></td></tr><tr><td>html_report_array</td><td><code>&lt;report_array&gt;</code></td><td>Optional output produced when <code>run_cellbender</code> is &quot;true&quot;; see CellBender <a href="https://cellbender.readthedocs.io/en/latest/usage/index.html" target="_blank" rel="noopener noreferrer">documentation</a> and <a href="https://github.com/broadinstitute/CellBender/tree/master" target="_blank" rel="noopener noreferrer">GitHub repository</a> for more information.</td><td></td></tr><tr><td>log</td><td><code>&lt;log&gt;</code></td><td>Optional output produced when <code>run_cellbender</code> is &quot;true&quot;; see CellBender <a href="https://cellbender.readthedocs.io/en/latest/usage/index.html" target="_blank" rel="noopener noreferrer">documentation</a> and <a href="https://github.com/broadinstitute/CellBender/tree/master" target="_blank" rel="noopener noreferrer">GitHub repository</a> for more information.</td><td></td></tr><tr><td>metrics_csv_array</td><td><code>&lt;metrics_array&gt;</code></td><td>Optional output produced when <code>run_cellbender</code> is &quot;true&quot;; see CellBender <a href="https://cellbender.readthedocs.io/en/latest/usage/index.html" target="_blank" rel="noopener noreferrer">documentation</a> and <a href="https://github.com/broadinstitute/CellBender/tree/master" target="_blank" rel="noopener noreferrer">GitHub repository</a> for more information.</td><td></td></tr><tr><td>output_directory</td><td><code>&lt;output_dir&gt;</code></td><td>Optional output produced when <code>run_cellbender</code> is &quot;true&quot;; see CellBender <a href="https://cellbender.readthedocs.io/en/latest/usage/index.html" target="_blank" rel="noopener noreferrer">documentation</a> and <a href="https://github.com/broadinstitute/CellBender/tree/master" target="_blank" rel="noopener noreferrer">GitHub repository</a> for more information.</td><td></td></tr><tr><td>summary_pdf</td><td><code>&lt;pdf&gt;</code></td><td>Optional output produced when <code>run_cellbender</code> is &quot;true&quot;; see CellBender <a href="https://cellbender.readthedocs.io/en/latest/usage/index.html" target="_blank" rel="noopener noreferrer">documentation</a> and <a href="https://github.com/broadinstitute/CellBender/tree/master" target="_blank" rel="noopener noreferrer">GitHub repository</a> for more information.</td><td></td></tr></tbody></table><p>The h5ad matrix is the default output. This matrix contains the unnormalized (unfiltered), UMI-corrected count matrices, as well as the gene and cell metrics detailed in the <a href="/warp/docs/Pipelines/Optimus_Pipeline/Loom_schema">Optimus Count Matrix Overview</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="try-the-optimus-matrix-with-community-tools">Try the Optimus matrix with community tools<a href="#try-the-optimus-matrix-with-community-tools" class="hash-link" aria-label="Direct link to Try the Optimus matrix with community tools" title="Direct link to Try the Optimus matrix with community tools">​</a></h4><p>The matrix is compatible with multiple downstream community analysis tools, including <a href="https://satijalab.org/seurat/index.html" target="_blank" rel="noopener noreferrer">Seurat</a>, <a href="https://scanpy.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">Scanpy</a>, <a href="https://cumulus.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">Cumulus</a>, and <a href="https://pegasus.readthedocs.io/en/stable/#" target="_blank" rel="noopener noreferrer">Pegasus</a>. To try a tutorial using the Optimus matrix with these tools, register for the open-source platform <a href="https://app.terra.bio" target="_blank" rel="noopener noreferrer">Terra</a> and then navigate to the public <a href="https://app.terra.bio/#workspaces/featured-workspaces-hca/Intro-to-HCA-data-on-Terra" target="_blank" rel="noopener noreferrer">Intro-to-HCA-data-on-Terra workspace</a>. You can also view the accompanying <a href="https://support.terra.bio/hc/en-us/articles/360060041772" target="_blank" rel="noopener noreferrer">step-by-step guide</a> without registration.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="validation-against-cell-ranger">Validation against Cell Ranger<a href="#validation-against-cell-ranger" class="hash-link" aria-label="Direct link to Validation against Cell Ranger" title="Direct link to Validation against Cell Ranger">​</a></h2><p>Optimus has been validated for processing both human and mouse single-cell and single-nucleus data (see links to validation reports in the table below). For each validation, Optimus results are compared to those of Cell Ranger (see the <a href="#faqs">FAQ</a> for more on Cell Ranger comparisons).</p><table><thead><tr><th>Workflow configuration</th><th>Link to Report</th></tr></thead><tbody><tr><td>Human 10x v2 single-cell</td><td><a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/benchmarking/v1_Apr2019/optimus_report.rst" target="_blank" rel="noopener noreferrer">Report</a></td></tr><tr><td>Mouse 10x v2 single-cell</td><td><a href="https://docs.google.com/document/d/1_3oO0ZQSrwEoe6D3GgKdSmAQ9qkzH_7wrE7x6_deL10/edit" target="_blank" rel="noopener noreferrer">Report</a></td></tr><tr><td>Human and mouse 10x v3 single-cell</td><td><a href="https://docs.google.com/document/d/1-hwfXkqtL8MblgDWFzk-HsVRYiy4PS8ZhJqAGlHBWYE/edit#heading=h.4uokn64v1s5m" target="_blank" rel="noopener noreferrer">Report</a></td></tr><tr><td>Human and Mouse 10x v2/v3 single-nucleus</td><td><a href="https://docs.google.com/document/d/1rv2M7vfpOzIOsMnMfNyKB4HV18lQ9dnOGHK2tPikiH0/edit" target="_blank" rel="noopener noreferrer">Report</a></td></tr><tr><td>Optimus STARsolo (v5.0.0 and later)</td><td><a href="https://docs.google.com/document/d/1B6Ux6HICD4ZL4Z0TG9LO-X43gOdF3sbq5qw_L2GA6fg/edit" target="_blank" rel="noopener noreferrer">Report</a></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="versioning">Versioning<a href="#versioning" class="hash-link" aria-label="Direct link to Versioning" title="Direct link to Versioning">​</a></h2><p>All Optimus pipeline releases are documented in the <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/Optimus.changelog.md" target="_blank" rel="noopener noreferrer">Optimus changelog</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="citing-the-optimus-pipeline">Citing the Optimus Pipeline<a href="#citing-the-optimus-pipeline" class="hash-link" aria-label="Direct link to Citing the Optimus Pipeline" title="Direct link to Citing the Optimus Pipeline">​</a></h2><p>If you use the Optimus Pipeline in your research, please identify the pipeline in your methods section using the <a href="https://scicrunch.org/resources/data/record/nlx_144509-1/SCR_018908/resolver?q=SCR_018908&amp;l=SCR_018908&amp;i=rrid:scr_018908" target="_blank" rel="noopener noreferrer">Optimus SciCrunch resource identifier</a>.</p><ul><li>Ex: <em>Optimus Pipeline (RRID:SCR_018908)</em></li></ul><p>When citing WARP, please use the following:</p><p>Kylee Degatano, Aseel Awdeh, Robert Sidney Cox III, Wes Dingman, George Grant, Farzaneh Khajouei, Elizabeth Kiernan, Kishori Konwar, Kaylee L Mathews, Kevin Palis, Nikelle Petrillo, Geraldine Van der Auwera, Chengchen (Rex) Wang, Jessica Way. &quot;Warp Analysis Research Pipelines: Cloud-optimized workflows for biological data processing and reproducible analysis.&quot; <em>Bioinformatics</em>, 2025; <a href="https://doi.org/10.1093/bioinformatics/btaf494" target="_blank" rel="noopener noreferrer">https://doi.org/10.1093/bioinformatics/btaf494</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consortia-support">Consortia support<a href="#consortia-support" class="hash-link" aria-label="Direct link to Consortia support" title="Direct link to Consortia support">​</a></h2><p>This pipeline is supported and used by the <a href="https://www.humancellatlas.org/" target="_blank" rel="noopener noreferrer">Human Cell Atlas</a> (HCA) project and the <a href="https://biccn.org/" target="_blank" rel="noopener noreferrer">BRAIN Initiative Cell Census Network</a> (BICCN). </p><p>Each consortium may use slightly different reference files for data analysis or have different post-processing steps. Learn more by reading the <a href="/warp/docs/Pipelines/Optimus_Pipeline/consortia-processing">Consortia Processing</a> overview.</p><p>If your organization also uses this pipeline, we would like to list you! Please reach out to us by <a href="https://github.com/broadinstitute/warp/issues" target="_blank" rel="noopener noreferrer">filing an issue in WARP</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="feedback">Feedback<a href="#feedback" class="hash-link" aria-label="Direct link to Feedback" title="Direct link to Feedback">​</a></h2><p>Please help us make our tools better by <a href="https://github.com/broadinstitute/warp/issues" target="_blank" rel="noopener noreferrer">filing an issue in WARP</a>; we welcome pipeline-related suggestions or questions.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="acknowledgements">Acknowledgements<a href="#acknowledgements" class="hash-link" aria-label="Direct link to Acknowledgements" title="Direct link to Acknowledgements">​</a></h2><p>We are immensely grateful to the members of the <a href="https://data.humancellatlas.org/" target="_blank" rel="noopener noreferrer">Human Cell Atlas Data Coordination Platform</a>,  BRAIN Initiative (<a href="https://brainblog.nih.gov/brain-blog/brain-issues-suite-funding-opportunities-advance-brain-cell-atlases-through-centers" target="_blank" rel="noopener noreferrer">BICAN</a> Sequencing Working Group) and <a href="https://nida.nih.gov/about-nida/organization/divisions/division-neuroscience-behavior-dnb/basic-research-hiv-substance-use-disorder/scorch-program" target="_blank" rel="noopener noreferrer">SCORCH</a> for their invaluable and exceptional contributions to this pipeline. Our heartfelt appreciation goes to Alex Dobin, Aparna Bhaduri, Alec Wysoker, Anish Chakka, Brian Herb, Daofeng Li, Fenna Krienen, Guo-Long Zuo, Jeff Goldy, Kai Zhang, Khalid Shakir, Bo Li, Mariano Gabitto, Michael DeBerardine, Mengyi Song, Melissa Goldman, Nelson Johansen, James Nemesh, and Theresa Hodges for their unwavering dedication and remarkable efforts. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="faqs">FAQs<a href="#faqs" class="hash-link" aria-label="Direct link to FAQs" title="Direct link to FAQs">​</a></h2><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Question Can I run Optimus in Terra?</div><div class="admonitionContent_S0QG"><p>Yes! We have a Terra workspace that is preconfigured with the latest Optimus workflow and is preloaded with human and mouse sample data. You can access the <a href="https://app.terra.bio/#workspaces/featured-workspaces-hca/HCA_Optimus_Pipeline" target="_blank" rel="noopener noreferrer">workspace</a>. You will need a Google account to set up Terra. Please see <a href="https://support.terra.bio/hc/en-us" target="_blank" rel="noopener noreferrer">Terra Support</a> for documents on getting started.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Question Is the output count matrix filtered or normalized?</div><div class="admonitionContent_S0QG"><p>No, we do not filter. We keep as much data as possible so that the researcher can make their own filtering and normalization choices. We do, however, output some information that may be helpful for filtering, like UMI counts per cell and calls on whether or not a cell is empty from emptyDrops software. For the emptyDrops call, a cell will be flagged as possibly empty if it contains fewer than 100 molecules.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Question How does the workflow change when using the single-cell RNA-seq (counting_mode = &#x27;sc_rna&#x27;) vs. the single-nucleus (counting_mode = &#x27;sn_rna&#x27;) parameters?</div><div class="admonitionContent_S0QG"><p>The counting_mode parameter is used to specify the STARsolo COUNTING_MODE; when sn_rna is specified, STARsolo will tag gene exons, UTRs, AND introns with the GX tag.  Additionally, the Optimus uses the counting_mode to determine whether to run emptyDrops; no emptyDrops data is calculated for the sn_rna mode.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Question Where can I find example Optimus datasets and parameters to test the pipeline?</div><div class="admonitionContent_S0QG"><p>There are four example configuration JSON files available for you to test the pipeline- the <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/human_v2_example.json" target="_blank" rel="noopener noreferrer">human_v2_example.json</a>, the <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/human_v3_example.json" target="_blank" rel="noopener noreferrer">human_v3_example.json</a>, the <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/mouse_v2_snRNA_example.json" target="_blank" rel="noopener noreferrer">mouse_v2_snRNA_example.json</a>, and the <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/mouse_v2_snRNA_example.json" target="_blank" rel="noopener noreferrer">mouse_v2_snRNA_example.json</a>(see the Inputs section). Each of these configuration files can be run in the Optimus Featured Workspace in Terra at <a href="https://app.terra.bio/#workspaces/featured-workspaces-hca/HCA_Optimus_Pipeline" target="_blank" rel="noopener noreferrer">https://app.terra.bio/#workspaces/featured-workspaces-hca/HCA_Optimus_Pipeline</a>, but you should note that the workspace comes preloaded with the same data and configurations.</p></div></div><p>The Optimus pipeline is a single sample pipeline, but it can accept multiple FASTQ files if a sample is sequenced across lanes. In this case, the pipeline will merge the results from each lane into single output files. There will only be one merged file for each output type (i.e one h5ad matrix, etc.). If you would like to view an example configuration file for a multi-lane dataset, please see the <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/example_inputs/mouse_v2_example.json" target="_blank" rel="noopener noreferrer">mouse_v2_example.json</a>.  Additionally, you can view sample outputs in the Optimus featured workspace on <a href="https://app.terra.bio/#workspaces/featured-workspaces-hca/HCA_Optimus_Pipeline" target="_blank" rel="noopener noreferrer">Terra</a>.
:::</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Question How do I find which parameters and Docker images were used for the different tasks (i.e. STAR alignment, emptyDrops, etc.)</div><div class="admonitionContent_S0QG"><p>Parameters are listed in each task WDL. For a list of the tasks, see the table in the <a href="#optimus-tasks-and-tools">Tasks and Tools Section</a>. Select the link for the task of interest and then view the parameters in the task WDL &quot;command {}&quot; section. For the task Docker image, see task WDL &quot;# runtime values&quot; section; the Docker is listed as &quot;String docker =  &quot;. If you want to learn more about all the different parameters available for a software tool, please select the relevant link in the table&#x27;s &quot;Tool&quot; column.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Question Does Optimus have any read length requirements?</div><div class="admonitionContent_S0QG"><p>For Read 1 sequences, the only minimum requirement is that reads are the combined lengths of the CB and UMIs (which will vary between 10x V1, V2, and V3 chemistry).</p><p>For Read 2 sequences, there is no read length requirement and read lengths will vary.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Question How does Optimus compare to Cell Ranger?</div><div class="admonitionContent_S0QG"><p>Cell Ranger is a commonly used set of analysis pipelines developed by <a href="https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/what-is-cell-ranger" target="_blank" rel="noopener noreferrer">10x Genomics</a>. Optimus and Cell Ranger share many features and additionally, Optimus results are validated against Cell Ranger results (see our <a href="https://github.com/broadinstitute/warp/blob/master/pipelines/wdl/optimus/benchmarking/v1_Apr2019/optimus_report.rst" target="_blank" rel="noopener noreferrer">human validation report</a>). </p><p><em>So why develop an independent pipeline for 10x data analyses?</em></p><p>For three reasons:
1) Need for an open-source, cloud-optimized pipeline. When Optimus was developed, Cell Ranger software was not yet open source, nor was it optimized for the cloud. To date, the Cell Ranger open-source code is still not regularly updated with Cell Ranger releases. In consequence, using the latest Cell Ranger (which is not open source yet) limits our ability to harness the breadth of tools available in the scientific community.</p><p>2) Flexibility to process data similar, but not identical, to 10x. We wanted the ability to evolve our pipeline to process non-10x data types that might use similar features such as combinatorial indexing.</p><p>3) Addition of metrics. We wanted the pipeline to calculate key metrics that would be useful to the scientific community, such as emptyDrops calculations, mitochondrial read metrics, etc.</p><p><em>Reference differences between Optimus and Cell Ranger</em></p><p>Unlike Cell Ranger references, Optimus references are downloaded directly from GENCODE and not modified to remove pseudogenes and small RNAs. Learn more about Cell Ranger references on the <a href="https://support.10xgenomics.com/single-cell-multiome-atac-gex/software/release-notes/references#header" target="_blank" rel="noopener noreferrer">10x website</a>. </p><p>In the case of multi-mapped pseudogenes, Optimus and Cell Ranger will produce different results. Optimus does not count multi-mapped reads in the final count matrix, whereas Cell Ranger will keep potential multi-mapped reads because it does not identify the pseudogene reads.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Question How does estimated cells differ between Cell Ranger and Optimus?</div><div class="admonitionContent_S0QG"><p>Overall, the estimated cells produced by Optimus and Cell Ranger should only slightly vary. However, if you are using Optimus in the Multiome pipeline and trying to compare estimated cells to Cell Ranger ARC, you might find that ARC calls fewer cells. This is because ARC sets a threshold that both the ATAC and gene expression cells must pass, whereas Optimus is only setting a threshold for the gene expression side of the pipeline.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><mdxadmonitiontitle>Question What are <a href="https://github.com/broadinstitute/warp/blob/develop/website/docs/Pipelines/Optimus_Pipeline/Library-metrics.md" target="_blank" rel="noopener noreferrer">library-level metrics</a> in the Optimus pipeline?</mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>Library-level metrics provide a summary of the sequencing library&#x27;s quality and performance across all cells, as opposed to per-cell metrics. These metrics offer insights into the overall efficiency, coverage, and quality of the sequencing data produced.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><mdxadmonitiontitle>How are <a href="https://github.com/broadinstitute/warp/blob/develop/website/docs/Pipelines/Optimus_Pipeline/Library-metrics.md" target="_blank" rel="noopener noreferrer">library-level metrics</a> calculated in Optimus?</mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>Library-level metrics in Optimus are calculated using a combination of STARsolo metrics and custom metrics as defined in the library metrics table linked in the actual documentation for gene expression data. These metrics assess key aspects like total reads, sequencing depth, and overall complexity of the library, offering a higher-level view of the data&#x27;s quality.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/broadinstitute/warp/edit/develop/website/docs/Pipelines/Optimus_Pipeline/README.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2026-02-11T20:27:07.000Z">Feb 11, 2026</time></b> by <b>jsotobroad</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/warp/docs/Pipelines/Multiome_Pipeline/README"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Multiome Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/warp/docs/Pipelines/Optimus_Pipeline/optimus.methods"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Optimus v7.8.1 Methods</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction-to-the-optimus-workflow" class="table-of-contents__link toc-highlight">Introduction to the Optimus workflow</a></li><li><a href="#quickstart-table" class="table-of-contents__link toc-highlight">Quickstart table</a></li><li><a href="#set-up" class="table-of-contents__link toc-highlight">Set-up</a><ul><li><a href="#optimus-installation" class="table-of-contents__link toc-highlight">Optimus installation</a></li><li><a href="#inputs" class="table-of-contents__link toc-highlight">Inputs</a></li></ul></li><li><a href="#optimus-tasks-and-tools" class="table-of-contents__link toc-highlight">Optimus tasks and tools</a></li><li><a href="#validation-against-cell-ranger" class="table-of-contents__link toc-highlight">Validation against Cell Ranger</a></li><li><a href="#versioning" class="table-of-contents__link toc-highlight">Versioning</a></li><li><a href="#citing-the-optimus-pipeline" class="table-of-contents__link toc-highlight">Citing the Optimus Pipeline</a></li><li><a href="#consortia-support" class="table-of-contents__link toc-highlight">Consortia support</a></li><li><a href="#feedback" class="table-of-contents__link toc-highlight">Feedback</a></li><li><a href="#acknowledgements" class="table-of-contents__link toc-highlight">Acknowledgements</a></li><li><a href="#faqs" class="table-of-contents__link toc-highlight">FAQs</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/warp/docs/get-started">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Guide and Policy</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/warp/docs/contribution/README">Contribution Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/warp/privacy">Privacy</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/warp/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/broadinstitute/warp/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item">Changelog</a></li><li class="footer__item"><a href="https://github.com/broadinstitute/warp" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Copyright © Data Sciences Platform, Broad Institute.</div></div></div></footer></div>
<script src="/warp/assets/js/runtime~main.a2ee2c75.js"></script>
<script src="/warp/assets/js/main.435ed8cb.js"></script>
</body>
</html>